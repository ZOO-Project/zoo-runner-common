{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"zoo-runner-common","text":"<p>Welcome to the documentation for zoo-runner-common, a Python package providing common base classes and utilities for implementing CWL runners in the ZOO-Project ecosystem.</p>"},{"location":"#overview","title":"Overview","text":"<p>This package provides the foundational <code>BaseRunner</code> class and utilities that are used by specific runner implementations (Calrissian, Argo Workflows, WES, etc.).</p>"},{"location":"#key-components","title":"Key Components","text":"<ul> <li> <p>BaseRunner: Abstract base class for CWL runners</p> <ul> <li>Standard interface for runner implementations</li> <li>Configuration management</li> <li>Process lifecycle management</li> <li>Error handling</li> </ul> </li> <li> <p>ZooConf: Configuration parser for ZOO-Project</p> <ul> <li>Parse ZOO configuration files</li> <li>Extract inputs/outputs</li> <li>Handle data types</li> </ul> </li> <li> <p>ZooStub: Testing stub for ZOO module</p> <ul> <li>Mock ZOO module for development and testing</li> <li>Service status codes</li> </ul> </li> </ul>"},{"location":"#architecture","title":"Architecture","text":"<pre><code>zoo-runner-common (base package)\n    \u251c\u2500\u2500 BaseRunner (abstract)\n    \u2502\n    \u251c\u2500\u2500 zoo-calrissian-runner\n    \u2502   \u2514\u2500\u2500 ZooCalrissianRunner extends BaseRunner\n    \u2502\n    \u251c\u2500\u2500 zoo-argowf-runner\n    \u2502   \u2514\u2500\u2500 ZooArgoWorkflowsRunner extends BaseRunner\n    \u2502\n    \u2514\u2500\u2500 zoo-wes-runner\n        \u2514\u2500\u2500 ZooWESRunner extends BaseRunner\n</code></pre>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code>from base_runner import BaseRunner\n\nclass MyRunner(BaseRunner):\n    def execute(self):\n        \"\"\"Implement execution logic\"\"\"\n        # Your runner implementation\n        pass\n</code></pre>"},{"location":"#runner-implementations","title":"Runner Implementations","text":"<ul> <li>zoo-calrissian-runner: Kubernetes-based runner using Calrissian</li> <li>zoo-argowf-runner: Argo Workflows-based runner</li> <li>zoo-wes-runner: GA4GH WES API-based runner</li> </ul>"},{"location":"#installation","title":"Installation","text":"<pre><code>pip install zoo-runner-common\n</code></pre>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Guide</li> <li>Implementing a New Runner</li> <li>API Reference</li> </ul>"},{"location":"about/changelog/","title":"Changelog","text":"<p>All notable changes to zoo-runner-common will be documented in this file.</p> <p>The format is based on Keep a Changelog, and this project adheres to Semantic Versioning.</p>"},{"location":"about/changelog/#unreleased","title":"[Unreleased]","text":""},{"location":"about/changelog/#added","title":"Added","text":"<ul> <li>Initial documentation structure</li> <li>Complete API reference</li> <li>User guides for BaseRunner, ZooConf, and ZooStub</li> <li>Examples and best practices</li> </ul>"},{"location":"about/changelog/#changed","title":"Changed","text":"<ul> <li>N/A</li> </ul>"},{"location":"about/changelog/#deprecated","title":"Deprecated","text":"<ul> <li>N/A</li> </ul>"},{"location":"about/changelog/#removed","title":"Removed","text":"<ul> <li>N/A</li> </ul>"},{"location":"about/changelog/#fixed","title":"Fixed","text":"<ul> <li>N/A</li> </ul>"},{"location":"about/changelog/#security","title":"Security","text":"<ul> <li>N/A</li> </ul>"},{"location":"about/changelog/#previous-releases","title":"Previous Releases","text":"<p>See GitHub Releases for the complete version history.</p>"},{"location":"about/changelog/#contributing","title":"Contributing","text":"<p>When contributing to this project, please update this changelog with your changes following the format above.</p>"},{"location":"about/changelog/#categories","title":"Categories","text":"<ul> <li>Added for new features</li> <li>Changed for changes in existing functionality</li> <li>Deprecated for soon-to-be removed features</li> <li>Removed for now removed features</li> <li>Fixed for any bug fixes</li> <li>Security in case of vulnerabilities</li> </ul>"},{"location":"api/base-runner/","title":"BaseRunner API Reference","text":""},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner","title":"<code>BaseRunner</code>","text":"<p>               Bases: <code>ABC</code></p> <p>Base class for CWL workflow runners. Provides common functionality and defines the interface for specific runners.</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>class BaseRunner(ABC):\n    \"\"\"\n    Base class for CWL workflow runners.\n    Provides common functionality and defines the interface for specific runners.\n    \"\"\"\n\n    def __init__(self, cwl, inputs, conf, outputs, execution_handler=None):\n        \"\"\"\n        Initialize the base runner.\n\n        :param cwl: CWL workflow definition (path to file or parsed CWL)\n        :param inputs: ZOO inputs dictionary\n        :param conf: ZOO configuration dictionary\n        :param outputs: ZOO outputs dictionary\n        :param execution_handler: Optional ExecutionHandler instance for hooks\n        \"\"\"\n        self.cwl = cwl\n        self.execution_handler = execution_handler or self._create_default_handler()\n\n        # Create typed wrapper objects from ZOO dictionaries\n        self.conf = ZooConf(conf)\n        self.inputs = ZooInputs(inputs)\n        self.outputs = ZooOutputs(outputs)\n\n        # Parse CWL workflow\n        self.workflow = CWLWorkflow(self.cwl, self.conf.workflow_id)\n\n        # Legacy namespace for backward compatibility\n        self.zoo_conf = types.SimpleNamespace(conf=conf)\n\n        # Runner-specific state\n        self.namespace_name = None\n        self.execution = None\n\n    def _create_default_handler(self):\n        \"\"\"Create a default handler if none provided.\"\"\"\n\n        class DefaultHandler:\n            def pre_execution_hook(self):\n                pass\n\n            def post_execution_hook(self, *args, **kwargs):\n                pass\n\n            def get_secrets(self):\n                return None\n\n            def get_additional_parameters(self):\n                return {}\n\n            def get_pod_env_vars(self):\n                return None\n\n            def get_pod_node_selector(self):\n                return None\n\n            def handle_outputs(self, *args, **kwargs):\n                pass\n\n            def set_job_id(self, job_id):\n                pass\n\n            def get_namespace(self):\n                \"\"\"Get namespace for Calrissian execution.\"\"\"\n                return None\n\n            def get_service_account(self):\n                \"\"\"Get service account for Calrissian execution.\"\"\"\n                return None\n\n        return DefaultHandler()\n\n    def update_status(self, progress: int, message: str = \"\"):\n        \"\"\"\n        Update execution status in ZOO.\n\n        Args:\n            progress: Progress percentage (0-100)\n            message: Status message to display\n        \"\"\"\n        if hasattr(self.conf, 'conf') and \"lenv\" in self.conf.conf:\n            self.conf.conf[\"lenv\"][\"message\"] = message\n            zoo.update_status(self.conf.conf, progress)\n        else:\n            logger.warning(\"Cannot update status: conf structure not available\")\n\n    def get_namespace_name(self):\n        \"\"\"\n        Generate a namespace name for Kubernetes resources.\n\n        Returns:\n            str: Namespace name in format {workflow_id}-{unique_id}\n        \"\"\"\n        if self.namespace_name is None:\n            import uuid\n            unique_id = str(uuid.uuid4())[:8]\n            self.namespace_name = f\"{self.get_workflow_id()}-{unique_id}\".lower()\n\n        return self.namespace_name\n\n    def log_output(self, output):\n        \"\"\"Log output information.\"\"\"\n        logger.info(\"[BaseRunner] Output: %s\", output)\n\n    def validate_inputs(self):\n        \"\"\"Validate input parameters.\"\"\"\n        logger.info(\"[BaseRunner] Validating inputs...\")\n        return True\n\n    def prepare(self):\n        \"\"\"\n        Shared pre-execution logic.\n        Calls execution handler hooks and prepares processing parameters.\n        \"\"\"\n        logger.info(\"execution started\")\n        self.update_status(progress=2, message=\"starting execution\")\n\n        # Call pre-execution hook\n        if self.execution_handler and hasattr(\n            self.execution_handler, \"pre_execution_hook\"\n        ):\n            try:\n                self.execution_handler.pre_execution_hook()\n            except Exception as e:\n                logger.error(f\"Error in pre_execution_hook: {e}\")\n                logger.error(traceback.format_exc())\n                raise\n\n        logger.info(\"wrap CWL workflow with stage-in/out steps\")\n\n        processing_parameters = {\n            **self.get_processing_parameters(),\n            **(\n                self.execution_handler.get_additional_parameters()\n                if self.execution_handler\n                else {}\n            ),\n        }\n\n        return types.SimpleNamespace(cwl=self.wrap(), params=processing_parameters)\n\n    def finalize(self, log, output, usage_report, tool_logs):\n        \"\"\"\n        Finalization logic after execution.\n        Calls execution handler post-execution and output handling hooks.\n        \"\"\"\n        logger.info(\"Finalization started\")\n\n        # Call post-execution hook\n        if self.execution_handler and hasattr(\n            self.execution_handler, \"post_execution_hook\"\n        ):\n            try:\n                self.execution_handler.post_execution_hook(\n                    log, output, usage_report, tool_logs\n                )\n            except Exception as e:\n                logger.error(f\"Error in post_execution_hook: {e}\")\n                logger.error(traceback.format_exc())\n                raise\n\n        # Call handle_outputs hook\n        if self.execution_handler and hasattr(self.execution_handler, \"handle_outputs\"):\n            try:\n                self.execution_handler.handle_outputs(\n                    log, output, usage_report, tool_logs\n                )\n            except Exception as e:\n                logger.error(f\"Error in handle_outputs: {e}\")\n                logger.error(traceback.format_exc())\n                raise\n\n    def get_workflow_id(self):\n        \"\"\"\n        Get the workflow identifier from configuration.\n\n        Returns:\n            str: The workflow identifier\n        \"\"\"\n        return self.conf.workflow_id\n\n    def get_workflow_inputs(self, mandatory=False):\n        \"\"\"\n        Get workflow input parameter names.\n\n        Args:\n            mandatory: If True, only return mandatory inputs (no default value)\n\n        Returns:\n            list: List of input parameter names\n        \"\"\"\n        return self.workflow.get_workflow_inputs(mandatory=mandatory)\n\n    def get_max_cores(self):\n        \"\"\"\n        Get the maximum number of cores from CWL ResourceRequirements.\n\n        Returns:\n            int: Maximum cores requested, or default from environment\n        \"\"\"\n        resources = self.workflow.eval_resource()\n        max_cores = max(resources[\"coresMax\"]) if resources[\"coresMax\"] else None\n\n        if max_cores is None:\n            max_cores = int(os.environ.get(\"DEFAULT_MAX_CORES\", \"2\"))\n\n        return max_cores\n\n    def get_max_ram(self):\n        \"\"\"\n        Get the maximum RAM in megabytes from CWL ResourceRequirements.\n\n        Returns:\n            str: Maximum RAM in MB with unit (e.g., \"4096Mi\")\n        \"\"\"\n        resources = self.workflow.eval_resource()\n        max_ram = max(resources[\"ramMax\"]) if resources[\"ramMax\"] else None\n\n        if max_ram is None:\n            max_ram = int(os.environ.get(\"DEFAULT_MAX_RAM\", \"4096\"))\n\n        # Return as string with Mi unit\n        return f\"{max_ram}Mi\"\n\n    def get_volume_size(self, unit=\"Mi\"):\n        \"\"\"\n        Get the volume size for temporary and output directories.\n\n        Calculates based on tmpdir and outdir requirements from CWL.\n\n        Args:\n            unit: Unit for volume size ('Gi' for Gigabytes or 'Mi' for Megabytes)\n\n        Returns:\n            str: Volume size with unit (e.g., \"10Gi\" or \"10240Mi\")\n        \"\"\"\n        resources = self.workflow.eval_resource()\n\n        # Get max tmpdir and outdir in MB\n        # Use Max if available, otherwise fall back to Min\n        tmpdir_max = max(resources[\"tmpdirMax\"]) if resources[\"tmpdirMax\"] else (max(resources[\"tmpdirMin\"]) if resources[\"tmpdirMin\"] else 0)\n        outdir_max = max(resources[\"outdirMax\"]) if resources[\"outdirMax\"] else (max(resources[\"outdirMin\"]) if resources[\"outdirMin\"] else 0)\n\n        # Total in MB\n        volume_size_mb = tmpdir_max + outdir_max\n\n        if volume_size_mb == 0:\n            # Default from environment\n            default = os.environ.get(\"DEFAULT_VOLUME_SIZE\", \"10Gi\")\n            # If default doesn't match requested unit, convert\n            if unit not in default:\n                return f\"10{unit}\"\n            return default\n\n        # Convert based on requested unit\n        if unit == \"Gi\":\n            # Convert MB to Gi (1 Gi = 1024 Mi)\n            volume_size = int(volume_size_mb / 1024) + 1\n        else:  # Mi\n            volume_size = volume_size_mb\n\n        return f\"{volume_size}{unit}\"\n\n    def assert_parameters(self, mandatory=True):\n        \"\"\"\n        Validate that required workflow inputs are provided.\n\n        Args:\n            mandatory: If True, check only mandatory inputs\n\n        Returns:\n            bool: True if all required inputs are present, False otherwise\n        \"\"\"\n        try:\n            required_inputs = self.get_workflow_inputs(mandatory=mandatory)\n\n            for required_input in required_inputs:\n                if required_input not in self.inputs.inputs:\n                    error_msg = f\"Missing required input: {required_input}\"\n                    logger.error(error_msg)\n                    return False\n\n            logger.info(\"All required parameters are present\")\n            return True\n        except Exception as e:\n            logger.error(f\"Error checking parameters: {e}\")\n            return False\n\n    def get_processing_parameters(self):\n        \"\"\"\n        Get processing parameters from inputs.\n\n        Returns:\n            dict: Processing parameters suitable for CWL execution\n        \"\"\"\n        return self.inputs.get_processing_parameters(workflow=self.workflow.get_workflow())\n\n    @abstractmethod\n    def wrap(self):\n        \"\"\"\n        Wrap the CWL workflow with stage-in/stage-out steps.\n        Must be implemented by subclasses.\n        \"\"\"\n        raise NotImplementedError(\"Subclasses must implement wrap()\")\n\n    @abstractmethod\n    def execute(self):\n        \"\"\"\n        Execute the CWL workflow.\n        Must be implemented by subclasses.\n        \"\"\"\n        raise NotImplementedError(\"Subclasses must implement execute()\")\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.__init__","title":"<code>__init__(cwl, inputs, conf, outputs, execution_handler=None)</code>","text":"<p>Initialize the base runner.</p> <p>:param cwl: CWL workflow definition (path to file or parsed CWL) :param inputs: ZOO inputs dictionary :param conf: ZOO configuration dictionary :param outputs: ZOO outputs dictionary :param execution_handler: Optional ExecutionHandler instance for hooks</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def __init__(self, cwl, inputs, conf, outputs, execution_handler=None):\n    \"\"\"\n    Initialize the base runner.\n\n    :param cwl: CWL workflow definition (path to file or parsed CWL)\n    :param inputs: ZOO inputs dictionary\n    :param conf: ZOO configuration dictionary\n    :param outputs: ZOO outputs dictionary\n    :param execution_handler: Optional ExecutionHandler instance for hooks\n    \"\"\"\n    self.cwl = cwl\n    self.execution_handler = execution_handler or self._create_default_handler()\n\n    # Create typed wrapper objects from ZOO dictionaries\n    self.conf = ZooConf(conf)\n    self.inputs = ZooInputs(inputs)\n    self.outputs = ZooOutputs(outputs)\n\n    # Parse CWL workflow\n    self.workflow = CWLWorkflow(self.cwl, self.conf.workflow_id)\n\n    # Legacy namespace for backward compatibility\n    self.zoo_conf = types.SimpleNamespace(conf=conf)\n\n    # Runner-specific state\n    self.namespace_name = None\n    self.execution = None\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.assert_parameters","title":"<code>assert_parameters(mandatory=True)</code>","text":"<p>Validate that required workflow inputs are provided.</p> <p>Parameters:</p> Name Type Description Default <code>mandatory</code> <p>If True, check only mandatory inputs</p> <code>True</code> <p>Returns:</p> Name Type Description <code>bool</code> <p>True if all required inputs are present, False otherwise</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def assert_parameters(self, mandatory=True):\n    \"\"\"\n    Validate that required workflow inputs are provided.\n\n    Args:\n        mandatory: If True, check only mandatory inputs\n\n    Returns:\n        bool: True if all required inputs are present, False otherwise\n    \"\"\"\n    try:\n        required_inputs = self.get_workflow_inputs(mandatory=mandatory)\n\n        for required_input in required_inputs:\n            if required_input not in self.inputs.inputs:\n                error_msg = f\"Missing required input: {required_input}\"\n                logger.error(error_msg)\n                return False\n\n        logger.info(\"All required parameters are present\")\n        return True\n    except Exception as e:\n        logger.error(f\"Error checking parameters: {e}\")\n        return False\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.execute","title":"<code>execute()</code>  <code>abstractmethod</code>","text":"<p>Execute the CWL workflow. Must be implemented by subclasses.</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>@abstractmethod\ndef execute(self):\n    \"\"\"\n    Execute the CWL workflow.\n    Must be implemented by subclasses.\n    \"\"\"\n    raise NotImplementedError(\"Subclasses must implement execute()\")\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.finalize","title":"<code>finalize(log, output, usage_report, tool_logs)</code>","text":"<p>Finalization logic after execution. Calls execution handler post-execution and output handling hooks.</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def finalize(self, log, output, usage_report, tool_logs):\n    \"\"\"\n    Finalization logic after execution.\n    Calls execution handler post-execution and output handling hooks.\n    \"\"\"\n    logger.info(\"Finalization started\")\n\n    # Call post-execution hook\n    if self.execution_handler and hasattr(\n        self.execution_handler, \"post_execution_hook\"\n    ):\n        try:\n            self.execution_handler.post_execution_hook(\n                log, output, usage_report, tool_logs\n            )\n        except Exception as e:\n            logger.error(f\"Error in post_execution_hook: {e}\")\n            logger.error(traceback.format_exc())\n            raise\n\n    # Call handle_outputs hook\n    if self.execution_handler and hasattr(self.execution_handler, \"handle_outputs\"):\n        try:\n            self.execution_handler.handle_outputs(\n                log, output, usage_report, tool_logs\n            )\n        except Exception as e:\n            logger.error(f\"Error in handle_outputs: {e}\")\n            logger.error(traceback.format_exc())\n            raise\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.get_max_cores","title":"<code>get_max_cores()</code>","text":"<p>Get the maximum number of cores from CWL ResourceRequirements.</p> <p>Returns:</p> Name Type Description <code>int</code> <p>Maximum cores requested, or default from environment</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def get_max_cores(self):\n    \"\"\"\n    Get the maximum number of cores from CWL ResourceRequirements.\n\n    Returns:\n        int: Maximum cores requested, or default from environment\n    \"\"\"\n    resources = self.workflow.eval_resource()\n    max_cores = max(resources[\"coresMax\"]) if resources[\"coresMax\"] else None\n\n    if max_cores is None:\n        max_cores = int(os.environ.get(\"DEFAULT_MAX_CORES\", \"2\"))\n\n    return max_cores\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.get_max_ram","title":"<code>get_max_ram()</code>","text":"<p>Get the maximum RAM in megabytes from CWL ResourceRequirements.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>Maximum RAM in MB with unit (e.g., \"4096Mi\")</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def get_max_ram(self):\n    \"\"\"\n    Get the maximum RAM in megabytes from CWL ResourceRequirements.\n\n    Returns:\n        str: Maximum RAM in MB with unit (e.g., \"4096Mi\")\n    \"\"\"\n    resources = self.workflow.eval_resource()\n    max_ram = max(resources[\"ramMax\"]) if resources[\"ramMax\"] else None\n\n    if max_ram is None:\n        max_ram = int(os.environ.get(\"DEFAULT_MAX_RAM\", \"4096\"))\n\n    # Return as string with Mi unit\n    return f\"{max_ram}Mi\"\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.get_namespace_name","title":"<code>get_namespace_name()</code>","text":"<p>Generate a namespace name for Kubernetes resources.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>Namespace name in format {workflow_id}-{unique_id}</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def get_namespace_name(self):\n    \"\"\"\n    Generate a namespace name for Kubernetes resources.\n\n    Returns:\n        str: Namespace name in format {workflow_id}-{unique_id}\n    \"\"\"\n    if self.namespace_name is None:\n        import uuid\n        unique_id = str(uuid.uuid4())[:8]\n        self.namespace_name = f\"{self.get_workflow_id()}-{unique_id}\".lower()\n\n    return self.namespace_name\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.get_processing_parameters","title":"<code>get_processing_parameters()</code>","text":"<p>Get processing parameters from inputs.</p> <p>Returns:</p> Name Type Description <code>dict</code> <p>Processing parameters suitable for CWL execution</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def get_processing_parameters(self):\n    \"\"\"\n    Get processing parameters from inputs.\n\n    Returns:\n        dict: Processing parameters suitable for CWL execution\n    \"\"\"\n    return self.inputs.get_processing_parameters(workflow=self.workflow.get_workflow())\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.get_volume_size","title":"<code>get_volume_size(unit='Mi')</code>","text":"<p>Get the volume size for temporary and output directories.</p> <p>Calculates based on tmpdir and outdir requirements from CWL.</p> <p>Parameters:</p> Name Type Description Default <code>unit</code> <p>Unit for volume size ('Gi' for Gigabytes or 'Mi' for Megabytes)</p> <code>'Mi'</code> <p>Returns:</p> Name Type Description <code>str</code> <p>Volume size with unit (e.g., \"10Gi\" or \"10240Mi\")</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def get_volume_size(self, unit=\"Mi\"):\n    \"\"\"\n    Get the volume size for temporary and output directories.\n\n    Calculates based on tmpdir and outdir requirements from CWL.\n\n    Args:\n        unit: Unit for volume size ('Gi' for Gigabytes or 'Mi' for Megabytes)\n\n    Returns:\n        str: Volume size with unit (e.g., \"10Gi\" or \"10240Mi\")\n    \"\"\"\n    resources = self.workflow.eval_resource()\n\n    # Get max tmpdir and outdir in MB\n    # Use Max if available, otherwise fall back to Min\n    tmpdir_max = max(resources[\"tmpdirMax\"]) if resources[\"tmpdirMax\"] else (max(resources[\"tmpdirMin\"]) if resources[\"tmpdirMin\"] else 0)\n    outdir_max = max(resources[\"outdirMax\"]) if resources[\"outdirMax\"] else (max(resources[\"outdirMin\"]) if resources[\"outdirMin\"] else 0)\n\n    # Total in MB\n    volume_size_mb = tmpdir_max + outdir_max\n\n    if volume_size_mb == 0:\n        # Default from environment\n        default = os.environ.get(\"DEFAULT_VOLUME_SIZE\", \"10Gi\")\n        # If default doesn't match requested unit, convert\n        if unit not in default:\n            return f\"10{unit}\"\n        return default\n\n    # Convert based on requested unit\n    if unit == \"Gi\":\n        # Convert MB to Gi (1 Gi = 1024 Mi)\n        volume_size = int(volume_size_mb / 1024) + 1\n    else:  # Mi\n        volume_size = volume_size_mb\n\n    return f\"{volume_size}{unit}\"\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.get_workflow_id","title":"<code>get_workflow_id()</code>","text":"<p>Get the workflow identifier from configuration.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>The workflow identifier</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def get_workflow_id(self):\n    \"\"\"\n    Get the workflow identifier from configuration.\n\n    Returns:\n        str: The workflow identifier\n    \"\"\"\n    return self.conf.workflow_id\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.get_workflow_inputs","title":"<code>get_workflow_inputs(mandatory=False)</code>","text":"<p>Get workflow input parameter names.</p> <p>Parameters:</p> Name Type Description Default <code>mandatory</code> <p>If True, only return mandatory inputs (no default value)</p> <code>False</code> <p>Returns:</p> Name Type Description <code>list</code> <p>List of input parameter names</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def get_workflow_inputs(self, mandatory=False):\n    \"\"\"\n    Get workflow input parameter names.\n\n    Args:\n        mandatory: If True, only return mandatory inputs (no default value)\n\n    Returns:\n        list: List of input parameter names\n    \"\"\"\n    return self.workflow.get_workflow_inputs(mandatory=mandatory)\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.log_output","title":"<code>log_output(output)</code>","text":"<p>Log output information.</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def log_output(self, output):\n    \"\"\"Log output information.\"\"\"\n    logger.info(\"[BaseRunner] Output: %s\", output)\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.prepare","title":"<code>prepare()</code>","text":"<p>Shared pre-execution logic. Calls execution handler hooks and prepares processing parameters.</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def prepare(self):\n    \"\"\"\n    Shared pre-execution logic.\n    Calls execution handler hooks and prepares processing parameters.\n    \"\"\"\n    logger.info(\"execution started\")\n    self.update_status(progress=2, message=\"starting execution\")\n\n    # Call pre-execution hook\n    if self.execution_handler and hasattr(\n        self.execution_handler, \"pre_execution_hook\"\n    ):\n        try:\n            self.execution_handler.pre_execution_hook()\n        except Exception as e:\n            logger.error(f\"Error in pre_execution_hook: {e}\")\n            logger.error(traceback.format_exc())\n            raise\n\n    logger.info(\"wrap CWL workflow with stage-in/out steps\")\n\n    processing_parameters = {\n        **self.get_processing_parameters(),\n        **(\n            self.execution_handler.get_additional_parameters()\n            if self.execution_handler\n            else {}\n        ),\n    }\n\n    return types.SimpleNamespace(cwl=self.wrap(), params=processing_parameters)\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.update_status","title":"<code>update_status(progress, message='')</code>","text":"<p>Update execution status in ZOO.</p> <p>Parameters:</p> Name Type Description Default <code>progress</code> <code>int</code> <p>Progress percentage (0-100)</p> required <code>message</code> <code>str</code> <p>Status message to display</p> <code>''</code> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def update_status(self, progress: int, message: str = \"\"):\n    \"\"\"\n    Update execution status in ZOO.\n\n    Args:\n        progress: Progress percentage (0-100)\n        message: Status message to display\n    \"\"\"\n    if hasattr(self.conf, 'conf') and \"lenv\" in self.conf.conf:\n        self.conf.conf[\"lenv\"][\"message\"] = message\n        zoo.update_status(self.conf.conf, progress)\n    else:\n        logger.warning(\"Cannot update status: conf structure not available\")\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.validate_inputs","title":"<code>validate_inputs()</code>","text":"<p>Validate input parameters.</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>def validate_inputs(self):\n    \"\"\"Validate input parameters.\"\"\"\n    logger.info(\"[BaseRunner] Validating inputs...\")\n    return True\n</code></pre>"},{"location":"api/base-runner/#zoo_runner_common.base_runner.BaseRunner.wrap","title":"<code>wrap()</code>  <code>abstractmethod</code>","text":"<p>Wrap the CWL workflow with stage-in/stage-out steps. Must be implemented by subclasses.</p> Source code in <code>zoo_runner_common/base_runner.py</code> <pre><code>@abstractmethod\ndef wrap(self):\n    \"\"\"\n    Wrap the CWL workflow with stage-in/stage-out steps.\n    Must be implemented by subclasses.\n    \"\"\"\n    raise NotImplementedError(\"Subclasses must implement wrap()\")\n</code></pre>"},{"location":"api/base-runner/#class-overview","title":"Class Overview","text":"<p><code>BaseRunner</code> is the abstract base class for implementing CWL workflow runners in ZOO-Project.</p>"},{"location":"api/base-runner/#constructor","title":"Constructor","text":"<pre><code>def __init__(self, cwl, inputs, conf, outputs, execution_handler=None)\n</code></pre> <p>Parameters:</p> <ul> <li><code>cwl</code>: CWL workflow definition (path or content)</li> <li><code>inputs</code>: ZOO inputs dictionary</li> <li><code>conf</code>: ZOO configuration dictionary</li> <li><code>outputs</code>: ZOO outputs dictionary</li> <li><code>execution_handler</code>: Optional execution handler instance (e.g., <code>CommonExecutionHandler</code>)</li> </ul>"},{"location":"api/base-runner/#abstract-methods","title":"Abstract Methods","text":"<p>Subclasses must implement these methods:</p>"},{"location":"api/base-runner/#execute","title":"execute()","text":"<p>Execute the CWL workflow.</p> <pre><code>@abstractmethod\ndef execute(self):\n    \"\"\"Execute the workflow\"\"\"\n    pass\n</code></pre>"},{"location":"api/base-runner/#wrap","title":"wrap()","text":"<p>Wrap the CWL workflow with stage-in/stage-out steps.</p> <pre><code>@abstractmethod\ndef wrap(self):\n    \"\"\"Wrap workflow with staging steps\"\"\"\n    pass\n</code></pre>"},{"location":"api/base-runner/#get_processing_parameters","title":"get_processing_parameters()","text":"<p>Get processing parameters specific to the runner.</p> <pre><code>@abstractmethod\ndef get_processing_parameters(self):\n    \"\"\"Get runner-specific parameters\"\"\"\n    pass\n</code></pre>"},{"location":"api/base-runner/#methods","title":"Methods","text":""},{"location":"api/base-runner/#prepare","title":"prepare()","text":"<p>Shared pre-execution logic.</p> <pre><code>def prepare(self)\n</code></pre> <p>Behavior:</p> <ol> <li>Logs execution start</li> <li>Updates status to 2%</li> <li>Calls <code>execution_handler.pre_execution_hook()</code></li> <li>Wraps CWL workflow</li> <li>Prepares processing parameters</li> </ol> <p>Returns: - SimpleNamespace with:   - <code>cwl</code>: Wrapped workflow   - <code>params</code>: Processing parameters</p> <p>Example:</p> <pre><code>prepared = runner.prepare()\nwrapped_cwl = prepared.cwl\nparams = prepared.params\n</code></pre>"},{"location":"api/base-runner/#finalize","title":"finalize()","text":"<p>Finalization logic after execution.</p> <pre><code>def finalize(self, log, output, usage_report, tool_logs)\n</code></pre> <p>Parameters:</p> <ul> <li><code>log</code>: Execution log</li> <li><code>output</code>: Workflow outputs</li> <li><code>usage_report</code>: Resource usage statistics</li> <li><code>tool_logs</code>: Tool execution logs</li> </ul> <p>Behavior:</p> <ol> <li>Calls <code>execution_handler.post_execution_hook()</code></li> <li>Calls <code>execution_handler.handle_outputs()</code></li> </ol> <p>Example:</p> <pre><code>runner.finalize(log, outputs, usage, tool_logs)\n</code></pre>"},{"location":"api/base-runner/#update_status","title":"update_status()","text":"<p>Update execution status in ZOO.</p> <pre><code>def update_status(self, progress: int, message: str = \"\")\n</code></pre> <p>Parameters:</p> <ul> <li><code>progress</code> (int): Progress percentage (0-100)</li> <li><code>message</code> (str): Status message</li> </ul> <p>Example:</p> <pre><code>runner.update_status(50, \"Processing data...\")\n</code></pre>"},{"location":"api/base-runner/#validate_inputs","title":"validate_inputs()","text":"<p>Validate input parameters.</p> <pre><code>def validate_inputs(self) -&gt; bool\n</code></pre> <p>Returns: - bool: True if inputs are valid</p> <p>Example:</p> <pre><code>if not runner.validate_inputs():\n    return zoo.SERVICE_FAILED\n</code></pre>"},{"location":"api/base-runner/#log_output","title":"log_output()","text":"<p>Log output information.</p> <pre><code>def log_output(self, output)\n</code></pre> <p>Parameters:</p> <ul> <li><code>output</code>: Output data to log</li> </ul>"},{"location":"api/base-runner/#get_namespace_name","title":"get_namespace_name()","text":"<p>Get or generate namespace name for execution.</p> <pre><code>def get_namespace_name(self) -&gt; str\n</code></pre> <p>Returns: - str: Namespace name (format: <code>{identifier}-{usid}</code>)</p> <p>Example:</p> <pre><code>namespace = runner.get_namespace_name()\n# Returns: \"process-name-12345\"\n</code></pre>"},{"location":"api/base-runner/#attributes","title":"Attributes","text":""},{"location":"api/base-runner/#cwl","title":"cwl","text":"<p>CWL workflow definition.</p>"},{"location":"api/base-runner/#inputs","title":"inputs","text":"<p>ZOO inputs dictionary.</p>"},{"location":"api/base-runner/#conf","title":"conf","text":"<p>ZOO configuration dictionary.</p>"},{"location":"api/base-runner/#outputs","title":"outputs","text":"<p>ZOO outputs dictionary.</p>"},{"location":"api/base-runner/#execution_handler","title":"execution_handler","text":"<p>Execution handler instance.</p>"},{"location":"api/base-runner/#namespace_name","title":"namespace_name","text":"<p>Kubernetes namespace name.</p>"},{"location":"api/base-runner/#zoo_conf","title":"zoo_conf","text":"<p>SimpleNamespace wrapper for configuration.</p>"},{"location":"api/base-runner/#default-handler","title":"Default Handler","text":"<p>If no execution handler is provided, BaseRunner creates a default handler with no-op methods:</p> <pre><code>class DefaultHandler:\n    def pre_execution_hook(self):\n        pass\n\n    def post_execution_hook(self, *args, **kwargs):\n        pass\n\n    def get_secrets(self):\n        return None\n\n    def get_additional_parameters(self):\n        return {}\n\n    def get_pod_env_vars(self):\n        return None\n\n    def get_pod_node_selector(self):\n        return None\n\n    def handle_outputs(self, *args, **kwargs):\n        pass\n\n    def set_job_id(self, job_id):\n        pass\n</code></pre>"},{"location":"api/base-runner/#usage-pattern","title":"Usage Pattern","text":"<pre><code>from base_runner import BaseRunner\n\nclass MyRunner(BaseRunner):\n    def execute(self):\n        \"\"\"Execute workflow\"\"\"\n        # Prepare\n        prepared = self.prepare()\n        self.update_status(20, \"Executing\")\n\n        # Execute\n        result = self.run_workflow(prepared.cwl, prepared.params)\n\n        # Finalize\n        self.finalize(None, result, None, None)\n\n        return zoo.SERVICE_SUCCEEDED\n\n    def wrap(self):\n        \"\"\"Wrap workflow\"\"\"\n        return self.cwl\n\n    def get_processing_parameters(self):\n        \"\"\"Get parameters\"\"\"\n        return {\"max_cores\": 8}\n\n# Use in service\ndef my_service(conf, inputs, outputs):\n    runner = MyRunner(cwl, inputs, conf, outputs, handler)\n    return runner.execute()\n</code></pre>"},{"location":"api/base-runner/#see-also","title":"See Also","text":"<ul> <li>BaseRunner Guide</li> <li>Implementing Runners</li> <li>ZooConf API</li> </ul>"},{"location":"api/zoo-conf/","title":"ZooConf API Reference","text":"<p>The <code>zoo_conf</code> module provides utilities for working with CWL workflows and ZOO-Project configuration.</p>"},{"location":"api/zoo-conf/#classes","title":"Classes","text":""},{"location":"api/zoo-conf/#zooconf","title":"ZooConf","text":"<p>Main configuration handler for ZOO-Project services.</p>"},{"location":"api/zoo-conf/#zoo_runner_common.zoo_conf.ZooConf","title":"<code>ZooConf</code>","text":"Source code in <code>zoo_runner_common/zoo_conf.py</code> <pre><code>class ZooConf:\n    def __init__(self, conf):\n        self.conf = conf\n        self.workflow_id = self.conf[\"lenv\"][\"Identifier\"]\n</code></pre>"},{"location":"api/zoo-conf/#zooinputs","title":"ZooInputs","text":"<p>Handler for ZOO-Project service inputs with type conversion and validation.</p>"},{"location":"api/zoo-conf/#zoo_runner_common.zoo_conf.ZooInputs","title":"<code>ZooInputs</code>","text":"Source code in <code>zoo_runner_common/zoo_conf.py</code> <pre><code>class ZooInputs:\n    def __init__(self, inputs):\n        # this conversion is necessary\n        # because zoo converts array of length 1 to a string\n        for inp in inputs:\n            if (\n                \"maxOccurs\" in inputs[inp].keys()\n                and int(inputs[inp][\"maxOccurs\"]) &gt; 1\n                and not isinstance(inputs[inp][\"value\"], list)\n            ):\n                inputs[inp][\"value\"] = [inputs[inp][\"value\"]]\n\n        self.inputs = inputs\n\n    def get_input_value(self, key):\n        try:\n            return self.inputs[key][\"value\"]\n        except KeyError as exc:\n            raise exc\n        except TypeError:\n            pass\n\n    def get_processing_parameters(self, workflow=None):\n        \"\"\"Returns a list with the input parameters keys\n\n        Args:\n            workflow: Optional CWL workflow object (currently unused, for future compatibility)\n        \"\"\"\n        import json\n\n        res = {}\n        allowed_types = [\"integer\", \"float\", \"boolean\", \"double\"]\n\n        for key, value in self.inputs.items():\n            if \"format\" in value and not(\"dataType\" in value and value[\"dataType\"] in allowed_types):\n                res[key] = {\n                    \"format\": value[\"format\"],\n                    \"value\": value[\"value\"],\n                }\n            elif \"dataType\" in value:\n                if isinstance(value[\"dataType\"], list):\n                    if value[\"dataType\"][0] in allowed_types:\n                        if value[\"dataType\"][0] in [\"double\", \"float\"]:\n                            res[key] = [float(item) for item in value[\"value\"]]\n                        elif value[\"dataType\"][0] == \"integer\":\n                            res[key] = [int(item) for item in value[\"value\"]]\n                        elif value[\"dataType\"][0] == \"boolean\":\n                            res[key] = [bool(item) for item in value[\"value\"]]\n                    else:\n                        res[key] = value[\"value\"]\n                else:\n                    if value[\"value\"] == \"NULL\":\n                        res[key] = None\n                    else:\n                        if value[\"dataType\"] in [\"double\", \"float\"]:\n                            res[key] = float(value[\"value\"])\n                        elif value[\"dataType\"] == \"integer\":\n                            res[key] = int(value[\"value\"])\n                        elif value[\"dataType\"] == \"boolean\":\n                            res[key] = bool(value[\"value\"])\n                        else:\n                            res[key] = value[\"value\"]\n            else:\n                if \"cache_file\" in value:\n                    if \"isArray\" in value and value[\"isArray\"] == \"true\":\n                        res[key] = []\n                        for i in range(len(value[\"value\"])):\n                            res[key].append({\n                                \"format\": value[\"mimeType\"][i] if \"mimeType\" in value else \"text/plain\",\n                                \"value\": value[\"value\"][i],\n                            })\n                    else:\n                        res[key] = {\n                            \"format\": value.get(\"mimeType\", \"text/plain\"),\n                            \"value\": value[\"value\"]\n                        }\n                else:\n                    if \"lowerCorner\" in value and \"upperCorner\" in value:\n                        res[key] = {\n                            \"format\": \"ogc-bbox\",\n                            \"bbox\": json.loads(value[\"value\"]),\n                            \"crs\": value[\"crs\"].replace(\"http://www.opengis.net/def/crs/OGC/1.3/\", \"\")\n                        }\n                    else:\n                        res[key] = value[\"value\"]\n        return res\n</code></pre>"},{"location":"api/zoo-conf/#zoo_runner_common.zoo_conf.ZooInputs.get_processing_parameters","title":"<code>get_processing_parameters(workflow=None)</code>","text":"<p>Returns a list with the input parameters keys</p> <p>Parameters:</p> Name Type Description Default <code>workflow</code> <p>Optional CWL workflow object (currently unused, for future compatibility)</p> <code>None</code> Source code in <code>zoo_runner_common/zoo_conf.py</code> <pre><code>def get_processing_parameters(self, workflow=None):\n    \"\"\"Returns a list with the input parameters keys\n\n    Args:\n        workflow: Optional CWL workflow object (currently unused, for future compatibility)\n    \"\"\"\n    import json\n\n    res = {}\n    allowed_types = [\"integer\", \"float\", \"boolean\", \"double\"]\n\n    for key, value in self.inputs.items():\n        if \"format\" in value and not(\"dataType\" in value and value[\"dataType\"] in allowed_types):\n            res[key] = {\n                \"format\": value[\"format\"],\n                \"value\": value[\"value\"],\n            }\n        elif \"dataType\" in value:\n            if isinstance(value[\"dataType\"], list):\n                if value[\"dataType\"][0] in allowed_types:\n                    if value[\"dataType\"][0] in [\"double\", \"float\"]:\n                        res[key] = [float(item) for item in value[\"value\"]]\n                    elif value[\"dataType\"][0] == \"integer\":\n                        res[key] = [int(item) for item in value[\"value\"]]\n                    elif value[\"dataType\"][0] == \"boolean\":\n                        res[key] = [bool(item) for item in value[\"value\"]]\n                else:\n                    res[key] = value[\"value\"]\n            else:\n                if value[\"value\"] == \"NULL\":\n                    res[key] = None\n                else:\n                    if value[\"dataType\"] in [\"double\", \"float\"]:\n                        res[key] = float(value[\"value\"])\n                    elif value[\"dataType\"] == \"integer\":\n                        res[key] = int(value[\"value\"])\n                    elif value[\"dataType\"] == \"boolean\":\n                        res[key] = bool(value[\"value\"])\n                    else:\n                        res[key] = value[\"value\"]\n        else:\n            if \"cache_file\" in value:\n                if \"isArray\" in value and value[\"isArray\"] == \"true\":\n                    res[key] = []\n                    for i in range(len(value[\"value\"])):\n                        res[key].append({\n                            \"format\": value[\"mimeType\"][i] if \"mimeType\" in value else \"text/plain\",\n                            \"value\": value[\"value\"][i],\n                        })\n                else:\n                    res[key] = {\n                        \"format\": value.get(\"mimeType\", \"text/plain\"),\n                        \"value\": value[\"value\"]\n                    }\n            else:\n                if \"lowerCorner\" in value and \"upperCorner\" in value:\n                    res[key] = {\n                        \"format\": \"ogc-bbox\",\n                        \"bbox\": json.loads(value[\"value\"]),\n                        \"crs\": value[\"crs\"].replace(\"http://www.opengis.net/def/crs/OGC/1.3/\", \"\")\n                    }\n                else:\n                    res[key] = value[\"value\"]\n    return res\n</code></pre>"},{"location":"api/zoo-conf/#methods","title":"Methods","text":""},{"location":"api/zoo-conf/#get_input_valuekey","title":"get_input_value(key)","text":"<p>Get the value of a specific input parameter.</p> <p>Parameters:</p> <ul> <li><code>key</code> (str): The input parameter key</li> </ul> <p>Returns:</p> <ul> <li>The input value</li> </ul> <p>Raises:</p> <ul> <li><code>KeyError</code>: If the input key doesn't exist</li> </ul> <p>Example:</p> <pre><code>zoo_inputs = ZooInputs(inputs)\nurl = zoo_inputs.get_input_value(\"data_url\")\n</code></pre>"},{"location":"api/zoo-conf/#get_processing_parameters","title":"get_processing_parameters()","text":"<p>Returns a dictionary of all input parameters with proper type conversion.</p> <p>Handles:</p> <ul> <li>Numeric types (int, float, double)</li> <li>Booleans</li> <li>Files with MIME types</li> <li>Arrays</li> </ul> <p>Returns:</p> <ul> <li><code>dict</code>: Dictionary of input parameters ready for CWL execution</li> </ul> <p>Example:</p> <pre><code>zoo_inputs = ZooInputs(inputs)\nparams = zoo_inputs.get_processing_parameters()\n# {'threshold': 0.5, 'input_file': {'class': 'File', 'path': '/tmp/data.tif', 'format': 'image/tiff'}}\n</code></pre>"},{"location":"api/zoo-conf/#zoooutputs","title":"ZooOutputs","text":"<p>Handler for ZOO-Project service outputs.</p>"},{"location":"api/zoo-conf/#zoo_runner_common.zoo_conf.ZooOutputs","title":"<code>ZooOutputs</code>","text":"Source code in <code>zoo_runner_common/zoo_conf.py</code> <pre><code>class ZooOutputs:\n    def __init__(self, outputs):\n        self.outputs = outputs\n        # decuce the output key\n        output_keys = list(self.outputs.keys())\n        if len(output_keys) &gt; 0:\n            self.output_key = output_keys[0]\n        else:\n            self.output_key = \"stac\"\n            if \"stac\" not in self.outputs.keys():\n                self.outputs[\"stac\"] = {}\n\n    def get_output_parameters(self):\n        \"\"\"Returns a list with the output parameters keys\"\"\"\n        return {key: value[\"value\"] for key, value in self.outputs.items()}\n\n    def set_output(self, value):\n        \"\"\"set the output result value\"\"\"\n        self.outputs[self.output_key][\"value\"] = value\n</code></pre>"},{"location":"api/zoo-conf/#zoo_runner_common.zoo_conf.ZooOutputs.get_output_parameters","title":"<code>get_output_parameters()</code>","text":"<p>Returns a list with the output parameters keys</p> Source code in <code>zoo_runner_common/zoo_conf.py</code> <pre><code>def get_output_parameters(self):\n    \"\"\"Returns a list with the output parameters keys\"\"\"\n    return {key: value[\"value\"] for key, value in self.outputs.items()}\n</code></pre>"},{"location":"api/zoo-conf/#zoo_runner_common.zoo_conf.ZooOutputs.set_output","title":"<code>set_output(value)</code>","text":"<p>set the output result value</p> Source code in <code>zoo_runner_common/zoo_conf.py</code> <pre><code>def set_output(self, value):\n    \"\"\"set the output result value\"\"\"\n    self.outputs[self.output_key][\"value\"] = value\n</code></pre>"},{"location":"api/zoo-conf/#methods_1","title":"Methods","text":""},{"location":"api/zoo-conf/#get_output_parameters","title":"get_output_parameters()","text":"<p>Returns a dictionary of all output parameters.</p> <p>Returns:</p> <ul> <li><code>dict</code>: Dictionary mapping output keys to their values</li> </ul> <p>Example:</p> <pre><code>zoo_outputs = ZooOutputs(outputs)\noutput_params = zoo_outputs.get_output_parameters()\n</code></pre>"},{"location":"api/zoo-conf/#set_outputvalue","title":"set_output(value)","text":"<p>Set the output result value for the primary output.</p> <p>Parameters:</p> <ul> <li><code>value</code>: The output value to set</li> </ul> <p>Example:</p> <pre><code>zoo_outputs = ZooOutputs(outputs)\nzoo_outputs.set_output(\"/tmp/results/catalog.json\")\n</code></pre>"},{"location":"api/zoo-conf/#cwl-workflow-classes","title":"CWL Workflow Classes","text":""},{"location":"api/zoo-conf/#cwlworkflow","title":"CWLWorkflow","text":"<p>Parser and utility class for CWL workflows.</p>"},{"location":"api/zoo-conf/#zoo_runner_common.zoo_conf.CWLWorkflow","title":"<code>CWLWorkflow</code>","text":"Source code in <code>zoo_runner_common/zoo_conf.py</code> <pre><code>class CWLWorkflow:\n    def __init__(self, cwl, workflow_id):\n        self.raw_cwl = cwl\n        self.workflow_id = workflow_id\n\n        # Load the entire CWL document and convert to v1.2\n        # Use load_cwl_from_yaml instead of load_document_by_yaml for proper version conversion\n        from cwl_loader import load_cwl_from_yaml\n\n        parsed_cwl = load_cwl_from_yaml(cwl, uri=\"io://\", cwl_version='v1.2', sort=True)\n\n        # Ensure self.cwl is always a list containing all CWL elements\n        if not isinstance(parsed_cwl, list):\n            parsed_cwl = [parsed_cwl]\n\n        self.cwl = parsed_cwl\n\n    def get_version(self):\n\n        return self.raw_cwl.get(\"s:softwareVersion\", \"\")\n\n    def get_label(self):\n\n        return self.get_workflow().label\n\n    def get_doc(self):\n\n        return self.get_workflow().doc\n\n    def get_workflow(self) -&gt; cwl_utils.parser.cwl_v1_0.Workflow:\n        # returns a cwl_utils.parser.cwl_v1_0.Workflow)\n        ids = [elem.id.split(\"#\")[-1] for elem in self.cwl]\n\n        return self.cwl[ids.index(self.workflow_id)]\n\n    def get_object_by_id(self, id):\n        ids = [elem.id.split(\"#\")[-1] for elem in self.cwl]\n        # Remove leading '#' if present, and also remove 'io://' prefix if present\n        search_id = id.lstrip(\"#\").replace(\"io://\", \"\")\n        return self.cwl[ids.index(search_id)]\n\n    def get_workflow_inputs(self, mandatory=False):\n        inputs = []\n        for inp in self.get_workflow().inputs:\n            if mandatory:\n                # Use type_ instead of type (cwl-utils API change)\n                inp_type = getattr(inp, 'type_', getattr(inp, 'type', None))\n                if inp.default is not None or inp_type == [\"null\", \"string\"]:\n                    continue\n                else:\n                    inputs.append(inp.id.split(\"/\")[-1])\n            else:\n                inputs.append(inp.id.split(\"/\")[-1])\n        return inputs\n\n    @staticmethod\n    def has_scatter_requirement(workflow):\n        return any(\n            isinstance(\n                requirement,\n                (\n                    cwl_utils.parser.cwl_v1_0.ScatterFeatureRequirement,\n                    cwl_utils.parser.cwl_v1_1.ScatterFeatureRequirement,\n                    cwl_utils.parser.cwl_v1_2.ScatterFeatureRequirement,\n                ),\n            )\n            for requirement in workflow.requirements\n        )\n\n    @staticmethod\n    def get_resource_requirement(elem):\n        \"\"\"Gets the ResourceRequirement out of a CommandLineTool or Workflow\n\n        Args:\n            elem (CommandLineTool or Workflow): CommandLineTool or Workflow\n\n        Returns:\n            cwl_utils.parser.cwl_v1_2.ResourceRequirement or ResourceRequirement\n        \"\"\"\n        resource_requirement = []\n\n        # look for requirements\n        if elem.requirements is not None:\n            resource_requirement = [\n                requirement\n                for requirement in elem.requirements\n                if isinstance(\n                    requirement,\n                    (\n                        cwl_utils.parser.cwl_v1_0.ResourceRequirement,\n                        cwl_utils.parser.cwl_v1_1.ResourceRequirement,\n                        cwl_utils.parser.cwl_v1_2.ResourceRequirement,\n                    ),\n                )\n            ]\n\n            if len(resource_requirement) == 1:\n                return resource_requirement[0]\n\n        # look for hints\n        if elem.hints is not None:\n            resource_requirement = []\n            for hint in elem.hints:\n                # Handle both dict and object types\n                if isinstance(hint, dict):\n                    if hint.get(\"class\") == \"ResourceRequirement\":\n                        resource_requirement.append(ResourceRequirement.from_dict(hint))\n                elif hasattr(hint, 'class_'):\n                    if hint.class_ == \"ResourceRequirement\":\n                        resource_requirement.append(hint)\n\n            if len(resource_requirement) == 1:\n                return resource_requirement[0]\n\n    def eval_resource(self):\n        resources = {\n            \"coresMin\": [],\n            \"coresMax\": [],\n            \"ramMin\": [],\n            \"ramMax\": [],\n            \"tmpdirMin\": [],\n            \"tmpdirMax\": [],\n            \"outdirMin\": [],\n            \"outdirMax\": [],\n        }\n\n        for elem in self.cwl:\n            if isinstance(\n                elem,\n                (\n                    cwl_utils.parser.cwl_v1_0.Workflow,\n                    cwl_utils.parser.cwl_v1_1.Workflow,\n                    cwl_utils.parser.cwl_v1_2.Workflow,\n                ),\n            ):\n                if resource_requirement := self.get_resource_requirement(elem):\n                    for resource_type in [\n                        \"coresMin\",\n                        \"coresMax\",\n                        \"ramMin\",\n                        \"ramMax\",\n                        \"tmpdirMin\",\n                        \"tmpdirMax\",\n                        \"outdirMin\",\n                        \"outdirMax\",\n                    ]:\n                        if getattr(resource_requirement, resource_type):\n                            resources[resource_type].append(\n                                getattr(resource_requirement, resource_type)\n                            )\n                for step in elem.steps:\n                    if resource_requirement := self.get_resource_requirement(\n                        self.get_object_by_id(step.run[1:])\n                    ):\n                        multiplier = (\n                            int(os.getenv(\"SCATTER_MULTIPLIER\", 2))\n                            if step.scatter\n                            else 1\n                        )\n                        for resource_type in [\n                            \"coresMin\",\n                            \"coresMax\",\n                            \"ramMin\",\n                            \"ramMax\",\n                            \"tmpdirMin\",\n                            \"tmpdirMax\",\n                            \"outdirMin\",\n                            \"outdirMax\",\n                        ]:\n                            if getattr(resource_requirement, resource_type):\n                                resources[resource_type].append(\n                                    getattr(resource_requirement, resource_type)\n                                    * multiplier\n                                )\n        return resources\n</code></pre>"},{"location":"api/zoo-conf/#zoo_runner_common.zoo_conf.CWLWorkflow.get_resource_requirement","title":"<code>get_resource_requirement(elem)</code>  <code>staticmethod</code>","text":"<p>Gets the ResourceRequirement out of a CommandLineTool or Workflow</p> <p>Parameters:</p> Name Type Description Default <code>elem</code> <code>CommandLineTool or Workflow</code> <p>CommandLineTool or Workflow</p> required <p>Returns:</p> Type Description <p>cwl_utils.parser.cwl_v1_2.ResourceRequirement or ResourceRequirement</p> Source code in <code>zoo_runner_common/zoo_conf.py</code> <pre><code>@staticmethod\ndef get_resource_requirement(elem):\n    \"\"\"Gets the ResourceRequirement out of a CommandLineTool or Workflow\n\n    Args:\n        elem (CommandLineTool or Workflow): CommandLineTool or Workflow\n\n    Returns:\n        cwl_utils.parser.cwl_v1_2.ResourceRequirement or ResourceRequirement\n    \"\"\"\n    resource_requirement = []\n\n    # look for requirements\n    if elem.requirements is not None:\n        resource_requirement = [\n            requirement\n            for requirement in elem.requirements\n            if isinstance(\n                requirement,\n                (\n                    cwl_utils.parser.cwl_v1_0.ResourceRequirement,\n                    cwl_utils.parser.cwl_v1_1.ResourceRequirement,\n                    cwl_utils.parser.cwl_v1_2.ResourceRequirement,\n                ),\n            )\n        ]\n\n        if len(resource_requirement) == 1:\n            return resource_requirement[0]\n\n    # look for hints\n    if elem.hints is not None:\n        resource_requirement = []\n        for hint in elem.hints:\n            # Handle both dict and object types\n            if isinstance(hint, dict):\n                if hint.get(\"class\") == \"ResourceRequirement\":\n                    resource_requirement.append(ResourceRequirement.from_dict(hint))\n            elif hasattr(hint, 'class_'):\n                if hint.class_ == \"ResourceRequirement\":\n                    resource_requirement.append(hint)\n\n        if len(resource_requirement) == 1:\n            return resource_requirement[0]\n</code></pre>"},{"location":"api/zoo-conf/#methods_2","title":"Methods","text":""},{"location":"api/zoo-conf/#get_version","title":"get_version()","text":"<p>Get the workflow version from CWL metadata.</p> <p>Returns:</p> <ul> <li><code>str</code>: Software version from <code>s:softwareVersion</code> field</li> </ul>"},{"location":"api/zoo-conf/#get_label","title":"get_label()","text":"<p>Get the workflow label.</p> <p>Returns:</p> <ul> <li><code>str</code>: Workflow label</li> </ul>"},{"location":"api/zoo-conf/#get_doc","title":"get_doc()","text":"<p>Get the workflow documentation.</p> <p>Returns:</p> <ul> <li><code>str</code>: Workflow documentation string</li> </ul>"},{"location":"api/zoo-conf/#get_workflow","title":"get_workflow()","text":"<p>Get the parsed CWL workflow object.</p> <p>Returns:</p> <ul> <li><code>cwl_utils.parser.cwl_v1_0.Workflow</code>: The parsed workflow object</li> </ul>"},{"location":"api/zoo-conf/#get_workflow_inputsmandatoryfalse","title":"get_workflow_inputs(mandatory=False)","text":"<p>Get list of workflow input parameter names.</p> <p>Parameters:</p> <ul> <li><code>mandatory</code> (bool): If True, only return mandatory inputs (no defaults)</li> </ul> <p>Returns:</p> <ul> <li><code>list</code>: List of input parameter names</li> </ul> <p>Example:</p> <pre><code>cwl_workflow = CWLWorkflow(cwl_dict, \"main-workflow\")\nall_inputs = cwl_workflow.get_workflow_inputs()\n# ['input_data', 'threshold', 'output_format']\n\nrequired_inputs = cwl_workflow.get_workflow_inputs(mandatory=True)\n# ['input_data']\n</code></pre>"},{"location":"api/zoo-conf/#eval_resource","title":"eval_resource()","text":"<p>Evaluate and aggregate resource requirements from the workflow and all steps.</p> <p>Considers:</p> <ul> <li>Workflow-level resource requirements</li> <li>Step-level resource requirements</li> <li>Scatter operations (multiplied by <code>SCATTER_MULTIPLIER</code> env var, default: 2)</li> </ul> <p>Returns:</p> <ul> <li><code>dict</code>: Dictionary with aggregated resource requirements:<ul> <li><code>coresMin</code>, <code>coresMax</code>: CPU cores</li> <li><code>ramMin</code>, <code>ramMax</code>: RAM in MB</li> <li><code>tmpdirMin</code>, <code>tmpdirMax</code>: Temporary directory space in MB</li> <li><code>outdirMin</code>, <code>outdirMax</code>: Output directory space in MB</li> </ul> </li> </ul> <p>Example:</p> <pre><code>cwl_workflow = CWLWorkflow(cwl_dict, \"main-workflow\")\nresources = cwl_workflow.eval_resource()\n# {\n#     'coresMin': [2, 4],\n#     'ramMin': [2048, 4096],\n#     ...\n# }\n</code></pre>"},{"location":"api/zoo-conf/#get_resource_requirementelem","title":"get_resource_requirement(elem)","text":"<p>Static method to extract ResourceRequirement from a CWL element.</p> <p>Parameters:</p> <ul> <li><code>elem</code>: CWL CommandLineTool or Workflow object</li> </ul> <p>Returns:</p> <ul> <li>ResourceRequirement object or None</li> </ul>"},{"location":"api/zoo-conf/#resourcerequirement","title":"ResourceRequirement","text":"<p>Data class for CWL resource requirements (used for hints).</p> <p>Attributes:</p> <ul> <li><code>coresMin</code> (int): Minimum CPU cores</li> <li><code>coresMax</code> (int): Maximum CPU cores</li> <li><code>ramMin</code> (int): Minimum RAM in MB</li> <li><code>ramMax</code> (int): Maximum RAM in MB</li> <li><code>tmpdirMin</code> (int): Minimum temporary directory space in MB</li> <li><code>tmpdirMax</code> (int): Maximum temporary directory space in MB</li> <li><code>outdirMin</code> (int): Minimum output directory space in MB</li> <li><code>outdirMax</code> (int): Maximum output directory space in MB</li> </ul>"},{"location":"api/zoo-conf/#zoo_runner_common.zoo_conf.ResourceRequirement","title":"<code>ResourceRequirement</code>","text":"Source code in <code>zoo_runner_common/zoo_conf.py</code> <pre><code>@attr.s\nclass ResourceRequirement:\n    coresMin = attr.ib(default=None)\n    coresMax = attr.ib(default=None)\n    ramMin = attr.ib(default=None)\n    ramMax = attr.ib(default=None)\n    tmpdirMin = attr.ib(default=None)\n    tmpdirMax = attr.ib(default=None)\n    outdirMin = attr.ib(default=None)\n    outdirMax = attr.ib(default=None)\n\n    @classmethod\n    def from_dict(cls, env):\n        return cls(\n            **{k: v for k, v in env.items() if k in inspect.signature(cls).parameters}\n        )\n</code></pre>"},{"location":"api/zoo-conf/#usage-examples","title":"Usage Examples","text":""},{"location":"api/zoo-conf/#basic-configuration-handling","title":"Basic Configuration Handling","text":"<pre><code>from zoo_conf import ZooConf, ZooInputs, ZooOutputs\n\ndef my_service(conf, inputs, outputs):\n    \"\"\"ZOO Service function\"\"\"\n    # Parse configuration\n    zoo_conf = ZooConf(conf)\n    workflow_id = zoo_conf.workflow_id\n\n    # Handle inputs\n    zoo_inputs = ZooInputs(inputs)\n    params = zoo_inputs.get_processing_parameters()\n\n    # Handle outputs\n    zoo_outputs = ZooOutputs(outputs)\n    zoo_outputs.set_output(\"/path/to/result\")\n\n    return 3  # SERVICE_SUCCEEDED\n</code></pre>"},{"location":"api/zoo-conf/#cwl-workflow-analysis","title":"CWL Workflow Analysis","text":"<pre><code>from zoo_conf import CWLWorkflow\n\n# Load CWL workflow\ncwl_dict = {\n    \"cwlVersion\": \"v1.0\",\n    \"$graph\": [...],\n    \"s:softwareVersion\": \"1.0.0\"\n}\n\nworkflow = CWLWorkflow(cwl_dict, \"main-workflow\")\n\n# Get metadata\nprint(f\"Version: {workflow.get_version()}\")\nprint(f\"Label: {workflow.get_label()}\")\n\n# Get inputs\nmandatory_inputs = workflow.get_workflow_inputs(mandatory=True)\nprint(f\"Required inputs: {mandatory_inputs}\")\n\n# Evaluate resources\nresources = workflow.eval_resource()\ntotal_cores = sum(resources['coresMin'])\ntotal_ram = sum(resources['ramMin'])\nprint(f\"Requires {total_cores} cores and {total_ram} MB RAM\")\n</code></pre>"},{"location":"api/zoo-conf/#type-conversion-example","title":"Type Conversion Example","text":"<pre><code># ZOO inputs with various types\ninputs = {\n    \"threshold\": {\n        \"dataType\": \"float\",\n        \"value\": \"0.75\"\n    },\n    \"iterations\": {\n        \"dataType\": \"integer\",\n        \"value\": \"10\"\n    },\n    \"input_file\": {\n        \"cache_file\": \"/tmp/data.tif\",\n        \"mimeType\": \"image/tiff\"\n    },\n    \"bands\": {\n        \"dataType\": \"string\",\n        \"maxOccurs\": \"3\",\n        \"value\": [\"B02\", \"B03\", \"B04\"]\n    }\n}\n\nzoo_inputs = ZooInputs(inputs)\nparams = zoo_inputs.get_processing_parameters()\n\n# Automatic type conversion:\n# {\n#     'threshold': 0.75,           # float\n#     'iterations': 10,             # int\n#     'input_file': {               # File object\n#         'class': 'File',\n#         'path': '/tmp/data.tif',\n#         'format': 'image/tiff'\n#     },\n#     'bands': ['B02', 'B03', 'B04']  # array\n# }\n</code></pre>"},{"location":"api/zoo-conf/#see-also","title":"See Also","text":"<ul> <li>User Guide: ZooConf</li> <li>BaseRunner API</li> <li>Implementing Custom Runners</li> </ul>"},{"location":"development/contributing/","title":"Contributing to zoo-runner-common","text":"<p>Thank you for your interest in contributing to zoo-runner-common!</p>"},{"location":"development/contributing/#getting-started","title":"Getting Started","text":""},{"location":"development/contributing/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.8+</li> <li>Git</li> </ul>"},{"location":"development/contributing/#setup","title":"Setup","text":"<pre><code>git clone https://github.com/ZOO-Project/zoo-runner-common.git\ncd zoo-runner-common\npython -m venv venv\nsource venv/bin/activate\npip install -e \".[dev]\"\n</code></pre>"},{"location":"development/contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"development/contributing/#1-create-a-branch","title":"1. Create a Branch","text":"<pre><code>git checkout -b feature/your-feature\n</code></pre>"},{"location":"development/contributing/#2-make-changes","title":"2. Make Changes","text":"<p>Follow coding standards:</p> <pre><code># Good\nclass MyRunner(BaseRunner):\n    \"\"\"\n    My custom runner implementation.\n\n    This runner executes CWL workflows using [backend].\n    \"\"\"\n\n    def execute(self):\n        \"\"\"Execute workflow with error handling\"\"\"\n        try:\n            prepared = self.prepare()\n            result = self.run_workflow(prepared.cwl)\n            self.finalize(None, result, None, None)\n            return zoo.SERVICE_SUCCEEDED\n        except Exception as e:\n            logger.error(f\"Execution failed: {e}\")\n            return zoo.SERVICE_FAILED\n</code></pre>"},{"location":"development/contributing/#3-write-tests","title":"3. Write Tests","text":"<pre><code># tests/test_myrunner.py\ndef test_runner_execution():\n    \"\"\"Test runner execution\"\"\"\n    runner = MyRunner(cwl, inputs, conf, outputs)\n    status = runner.execute()\n    assert status == zoo.SERVICE_SUCCEEDED\n</code></pre> <p>Run tests:</p> <pre><code>pytest tests/\n</code></pre>"},{"location":"development/contributing/#4-update-documentation","title":"4. Update Documentation","text":"<ul> <li>Add docstrings</li> <li>Update relevant docs in <code>docs/</code></li> <li>Add examples</li> </ul>"},{"location":"development/contributing/#5-commit-and-push","title":"5. Commit and Push","text":"<pre><code>git add .\ngit commit -m \"feat: add new feature\"\ngit push origin feature/your-feature\n</code></pre>"},{"location":"development/contributing/#6-create-pull-request","title":"6. Create Pull Request","text":"<p>Create PR on GitHub with: - Clear description - Related issues - Test results</p>"},{"location":"development/contributing/#code-standards","title":"Code Standards","text":""},{"location":"development/contributing/#python-style","title":"Python Style","text":"<ul> <li>Follow PEP 8</li> <li>Use type hints</li> <li>Write docstrings</li> </ul> <pre><code>def my_method(self, param: str) -&gt; bool:\n    \"\"\"\n    Short description.\n\n    Args:\n        param: Parameter description\n\n    Returns:\n        True if successful\n    \"\"\"\n    pass\n</code></pre>"},{"location":"development/contributing/#testing","title":"Testing","text":"<ul> <li>Write unit tests</li> <li>Aim for &gt;80% coverage</li> <li>Test error cases</li> </ul>"},{"location":"development/contributing/#documentation","title":"Documentation","text":""},{"location":"development/contributing/#docstrings","title":"Docstrings","text":"<p>Use Google style:</p> <pre><code>def prepare(self):\n    \"\"\"\n    Prepare for execution.\n\n    This method calls the pre-execution hook and wraps\n    the CWL workflow with staging steps.\n\n    Returns:\n        SimpleNamespace with 'cwl' and 'params' attributes\n\n    Raises:\n        Exception: If pre-execution hook fails\n    \"\"\"\n    pass\n</code></pre>"},{"location":"development/contributing/#questions","title":"Questions?","text":"<ul> <li>Open an issue</li> <li>Start a discussion</li> <li>Contact maintainers</li> </ul> <p>Thank you for contributing! \ud83c\udf89</p>"},{"location":"development/implementing-runners/","title":"Implementing a New Runner","text":"<p>This guide walks through implementing a new CWL runner for ZOO-Project.</p>"},{"location":"development/implementing-runners/#overview","title":"Overview","text":"<p>To create a new runner, you need to:</p> <ol> <li>Extend <code>BaseRunner</code></li> <li>Implement the <code>execute()</code> method</li> <li>Handle workflow execution logic</li> <li>Process outputs</li> </ol>"},{"location":"development/implementing-runners/#basic-structure","title":"Basic Structure","text":"<pre><code>from base_runner import BaseRunner\nimport logging\n\nlogger = logging.getLogger(__name__)\n\nclass MyRunner(BaseRunner):\n    \"\"\"\n    Custom CWL runner implementation.\n\n    This runner executes CWL workflows using [your backend].\n    \"\"\"\n\n    def __init__(self, cwl, inputs, conf, outputs, execution_handler=None):\n        \"\"\"Initialize runner\"\"\"\n        super().__init__(cwl, inputs, conf, outputs, execution_handler)\n        # Add custom initialization\n        self.client = None\n\n    def execute(self):\n        \"\"\"Execute the workflow\"\"\"\n        try:\n            # 1. Prepare\n            self.prepare()\n            self.update_status(10, \"Initializing\")\n\n            # 2. Validate\n            if not self.validate_inputs():\n                return self.SERVICE_FAILED\n\n            # 3. Execute workflow\n            self.update_status(30, \"Executing workflow\")\n            result = self._run_workflow()\n\n            # 4. Process outputs\n            self.update_status(80, \"Processing outputs\")\n            self._process_outputs(result)\n\n            # 5. Finish\n            self.update_status(100, \"Complete\")\n            return self.SERVICE_SUCCEEDED\n\n        except Exception as e:\n            logger.error(f\"Execution failed: {e}\", exc_info=True)\n            self.conf[\"lenv\"][\"message\"] = str(e)\n            return self.SERVICE_FAILED\n\n    def _run_workflow(self):\n        \"\"\"Execute workflow on backend\"\"\"\n        # Implement your workflow execution logic\n        pass\n\n    def _process_outputs(self, result):\n        \"\"\"Process workflow outputs\"\"\"\n        # Process and populate self.outputs\n        pass\n</code></pre>"},{"location":"development/implementing-runners/#step-by-step-implementation","title":"Step-by-Step Implementation","text":""},{"location":"development/implementing-runners/#step-1-setup-project","title":"Step 1: Setup Project","text":"<p>Create your runner package:</p> <pre><code>mkdir zoo-myrunner\ncd zoo-myrunner\n</code></pre> <p>Create <code>setup.py</code>:</p> <pre><code>from setuptools import setup, find_packages\n\nsetup(\n    name=\"zoo-myrunner\",\n    version=\"0.1.0\",\n    packages=find_packages(),\n    install_requires=[\n        \"zoo-runner-common&gt;=0.1.0\",\n        # Add your specific dependencies\n    ],\n    author=\"Your Name\",\n    description=\"My CWL runner for ZOO-Project\",\n)\n</code></pre>"},{"location":"development/implementing-runners/#step-2-implement-runner","title":"Step 2: Implement Runner","text":"<p>Create <code>zoo_myrunner/runner.py</code>:</p> <pre><code>from base_runner import BaseRunner\nimport logging\nimport subprocess\nimport json\nimport os\n\nlogger = logging.getLogger(__name__)\n\nclass MyRunner(BaseRunner):\n    \"\"\"My CWL runner implementation\"\"\"\n\n    def __init__(self, cwl, inputs, conf, outputs, execution_handler=None):\n        super().__init__(cwl, inputs, conf, outputs, execution_handler)\n        self.work_dir = conf.get(\"main\", {}).get(\"tmpPath\", \"/tmp\")\n        self.job_id = None\n\n    def execute(self):\n        \"\"\"Execute CWL workflow\"\"\"\n        try:\n            # Prepare execution\n            self.prepare()\n            self.update_status(10, \"Preparing workflow\")\n\n            # Validate inputs\n            if not self.validate_inputs():\n                raise ValueError(\"Input validation failed\")\n\n            # Setup execution environment\n            self.update_status(20, \"Setting up environment\")\n            self._setup_environment()\n\n            # Submit workflow\n            self.update_status(30, \"Submitting workflow\")\n            self.job_id = self._submit_workflow()\n\n            # Notify handler of job ID\n            self.execution_handler.set_job_id(self.job_id)\n\n            # Monitor execution\n            self.update_status(40, \"Executing workflow\")\n            result = self._monitor_execution()\n\n            # Download outputs\n            self.update_status(80, \"Downloading outputs\")\n            self._download_outputs(result)\n\n            # Post-process\n            self.update_status(90, \"Post-processing\")\n            self._post_process()\n\n            # Complete\n            self.update_status(100, \"Workflow complete\")\n            return self.SERVICE_SUCCEEDED\n\n        except Exception as e:\n            logger.error(f\"Execution failed: {e}\", exc_info=True)\n            self.conf[\"lenv\"][\"message\"] = str(e)\n            return self.SERVICE_FAILED\n\n    def _setup_environment(self):\n        \"\"\"Setup execution environment\"\"\"\n        # Get environment variables from handler\n        env_vars = self.execution_handler.get_pod_env_vars()\n        if env_vars:\n            os.environ.update(env_vars)\n\n        # Get additional parameters\n        params = self.execution_handler.get_additional_parameters()\n        self.max_cores = params.get(\"max_cores\", 4)\n        self.max_ram = params.get(\"max_ram\", \"8G\")\n\n        logger.info(f\"Environment configured: cores={self.max_cores}, ram={self.max_ram}\")\n\n    def _submit_workflow(self):\n        \"\"\"Submit workflow to backend\"\"\"\n        # Example: submit to a workflow engine\n        cmd = [\n            \"my-workflow-tool\", \"submit\",\n            \"--cwl\", self.cwl,\n            \"--inputs\", self._prepare_inputs_file(),\n            \"--cores\", str(self.max_cores),\n            \"--memory\", self.max_ram\n        ]\n\n        result = subprocess.run(cmd, capture_output=True, text=True, check=True)\n        job_id = result.stdout.strip()\n\n        logger.info(f\"Workflow submitted: {job_id}\")\n        return job_id\n\n    def _prepare_inputs_file(self):\n        \"\"\"Prepare inputs file for workflow\"\"\"\n        inputs_file = os.path.join(self.work_dir, \"inputs.json\")\n\n        # Convert ZOO inputs to CWL inputs format\n        cwl_inputs = {}\n        for key, value in self.inputs.items():\n            cwl_inputs[key] = value.get(\"value\")\n\n        with open(inputs_file, \"w\") as f:\n            json.dump(cwl_inputs, f)\n\n        return inputs_file\n\n    def _monitor_execution(self):\n        \"\"\"Monitor workflow execution\"\"\"\n        import time\n\n        while True:\n            status = self._get_job_status()\n\n            if status[\"state\"] == \"completed\":\n                logger.info(\"Workflow completed successfully\")\n                return status\n            elif status[\"state\"] == \"failed\":\n                raise RuntimeError(f\"Workflow failed: {status.get('error')}\")\n            elif status[\"state\"] == \"running\":\n                progress = 40 + int(status.get(\"progress\", 0) * 0.4)\n                self.update_status(progress, f\"Running: {status.get('step', 'processing')}\")\n\n            time.sleep(10)\n\n    def _get_job_status(self):\n        \"\"\"Get job status from backend\"\"\"\n        cmd = [\"my-workflow-tool\", \"status\", self.job_id]\n        result = subprocess.run(cmd, capture_output=True, text=True, check=True)\n        return json.loads(result.stdout)\n\n    def _download_outputs(self, result):\n        \"\"\"Download workflow outputs\"\"\"\n        output_dir = os.path.join(self.work_dir, \"outputs\")\n        os.makedirs(output_dir, exist_ok=True)\n\n        # Download outputs from backend\n        cmd = [\"my-workflow-tool\", \"outputs\", self.job_id, \"--dest\", output_dir]\n        subprocess.run(cmd, capture_output=True, text=True, check=True)\n\n        # Populate ZOO outputs\n        for output_name in self.outputs.keys():\n            output_path = os.path.join(output_dir, f\"{output_name}.json\")\n            if os.path.exists(output_path):\n                with open(output_path) as f:\n                    self.outputs[output_name][\"value\"] = f.read()\n\n        logger.info(\"Outputs downloaded\")\n\n    def _post_process(self):\n        \"\"\"Post-process outputs\"\"\"\n        # Call handler post-execution hook\n        self.execution_handler.post_execution_hook(\n            log=None,\n            output=self.outputs,\n            usage_report=None,\n            tool_logs=None\n        )\n\n        # Additional post-processing\n        self.execution_handler.handle_outputs(None, self.outputs, None, None)\n</code></pre>"},{"location":"development/implementing-runners/#step-3-create-zoo-service","title":"Step 3: Create ZOO Service","text":"<p>Create <code>zoo_myrunner/service.py</code>:</p> <pre><code>from zoo_myrunner.runner import MyRunner\nfrom zoo_template_common import CommonExecutionHandler\n\ndef execute_workflow(conf, inputs, outputs):\n    \"\"\"\n    ZOO Service for executing CWL workflows with MyRunner.\n\n    Args:\n        conf: ZOO configuration dictionary\n        inputs: ZOO inputs dictionary\n        outputs: ZOO outputs dictionary\n\n    Returns:\n        int: ZOO service status code (3=success, 4=failure)\n    \"\"\"\n    try:\n        # Get CWL document\n        cwl = conf[\"lenv\"].get(\"cwl_document\")\n        if not cwl:\n            conf[\"lenv\"][\"message\"] = \"No CWL document provided\"\n            return 4\n\n        # Create execution handler\n        handler = CommonExecutionHandler(conf, outputs)\n\n        # Create and execute runner\n        runner = MyRunner(cwl, inputs, conf, outputs, handler)\n        status = runner.execute()\n\n        return status\n\n    except Exception as e:\n        import logging\n        logger = logging.getLogger(__name__)\n        logger.error(f\"Service failed: {e}\", exc_info=True)\n        conf[\"lenv\"][\"message\"] = str(e)\n        return 4\n</code></pre>"},{"location":"development/implementing-runners/#step-4-add-configuration","title":"Step 4: Add Configuration","text":"<p>Create <code>zoo_myrunner/__init__.py</code>:</p> <pre><code>\"\"\"My CWL Runner for ZOO-Project\"\"\"\n\n__version__ = \"0.1.0\"\n\nfrom .runner import MyRunner\nfrom .service import execute_workflow\n\n__all__ = [\"MyRunner\", \"execute_workflow\"]\n</code></pre>"},{"location":"development/implementing-runners/#step-5-write-tests","title":"Step 5: Write Tests","text":"<p>Create <code>tests/test_myrunner.py</code>:</p> <pre><code>import pytest\nfrom zoo_myrunner import MyRunner\nfrom unittest.mock import Mock, patch\n\ndef test_runner_initialization():\n    \"\"\"Test runner initialization\"\"\"\n    cwl = \"/path/to/workflow.cwl\"\n    inputs = {\"input1\": {\"value\": \"test\"}}\n    conf = {\"lenv\": {\"message\": \"\"}, \"main\": {\"tmpPath\": \"/tmp\"}}\n    outputs = {}\n\n    runner = MyRunner(cwl, inputs, conf, outputs)\n\n    assert runner.cwl == cwl\n    assert runner.inputs == inputs\n    assert runner.conf == conf\n    assert runner.outputs == outputs\n\n@patch('subprocess.run')\ndef test_workflow_submission(mock_run):\n    \"\"\"Test workflow submission\"\"\"\n    mock_run.return_value = Mock(stdout=\"job-12345\", returncode=0)\n\n    runner = MyRunner(\"/workflow.cwl\", {}, {\"lenv\": {}, \"main\": {}}, {})\n    runner._setup_environment()\n    job_id = runner._submit_workflow()\n\n    assert job_id == \"job-12345\"\n    assert mock_run.called\n\ndef test_input_preparation():\n    \"\"\"Test input file preparation\"\"\"\n    inputs = {\n        \"input1\": {\"value\": \"value1\"},\n        \"input2\": {\"value\": \"value2\"}\n    }\n\n    runner = MyRunner(\"/workflow.cwl\", inputs, {\"main\": {\"tmpPath\": \"/tmp\"}}, {})\n    inputs_file = runner._prepare_inputs_file()\n\n    import json\n    with open(inputs_file) as f:\n        cwl_inputs = json.load(f)\n\n    assert cwl_inputs[\"input1\"] == \"value1\"\n    assert cwl_inputs[\"input2\"] == \"value2\"\n</code></pre>"},{"location":"development/implementing-runners/#step-6-add-documentation","title":"Step 6: Add Documentation","text":"<p>Create <code>README.md</code>:</p> <pre><code># My CWL Runner for ZOO-Project\n\nCWL runner implementation using [your backend].\n\n## Installation\n\n```bash\npip install zoo-myrunner\n</code></pre>"},{"location":"development/implementing-runners/#usage","title":"Usage","text":"<pre><code>from zoo_myrunner import MyRunner\nfrom zoo_template_common import CommonExecutionHandler\n\nhandler = CommonExecutionHandler(conf, outputs)\nrunner = MyRunner(cwl, inputs, conf, outputs, handler)\nstatus = runner.execute()\n</code></pre>"},{"location":"development/implementing-runners/#configuration","title":"Configuration","text":"<p>Set environment variables:</p> <ul> <li><code>MY_BACKEND_URL</code>: Backend API URL</li> <li><code>MY_BACKEND_TOKEN</code>: Authentication token</li> </ul>"},{"location":"development/implementing-runners/#features","title":"Features","text":"<ul> <li>Automatic workflow submission</li> <li>Progress monitoring</li> <li>Output retrieval</li> <li>Error handling <pre><code>### Step 7: Package and Publish\n\nBuild the package:\n\n```bash\npython setup.py sdist bdist_wheel\n</code></pre></li> </ul> <p>Publish to PyPI:</p> <pre><code>pip install twine\ntwine upload dist/*\n</code></pre>"},{"location":"development/implementing-runners/#integration-with-zoo-cwl-runners","title":"Integration with zoo-cwl-runners","text":"<p>To integrate with the main runners package:</p> <ol> <li>Add to <code>zoo-cwl-runners/main_runner.py</code>:</li> </ol> <pre><code>def select_runner():\n    \"\"\"Select appropriate runner\"\"\"\n    runner_type = os.environ.get(\"ZOO_RUNNER\", \"calrissian\")\n\n    if runner_type == \"myrunner\":\n        from zoo_myrunner import MyRunner\n        return MyRunner\n    # ... other runners\n</code></pre> <ol> <li>Add to dependencies:</li> </ol> <pre><code>install_requires=[\n    \"zoo-myrunner&gt;=0.1.0\",\n]\n</code></pre>"},{"location":"development/implementing-runners/#best-practices","title":"Best Practices","text":"<ol> <li>Error Handling: Catch and log all exceptions</li> <li>Status Updates: Keep users informed of progress</li> <li>Cleanup: Clean up temporary files and resources</li> <li>Testing: Write comprehensive unit and integration tests</li> <li>Documentation: Document configuration and usage</li> <li>Logging: Use structured logging for debugging</li> </ol>"},{"location":"development/implementing-runners/#see-also","title":"See Also","text":"<ul> <li>BaseRunner API</li> <li>BaseRunner User Guide</li> <li>ZooConf User Guide</li> <li>zoo-cwl-runners Documentation - Real implementation examples</li> <li>ZOO-Project Documentation</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.8 or higher</li> <li>pip package manager</li> </ul>"},{"location":"getting-started/installation/#from-pypi","title":"From PyPI","text":"<pre><code>pip install zoo-runner-common\n</code></pre>"},{"location":"getting-started/installation/#from-source","title":"From Source","text":"<pre><code>git clone https://github.com/ZOO-Project/zoo-runner-common.git\ncd zoo-runner-common\npip install .\n</code></pre>"},{"location":"getting-started/installation/#development-installation","title":"Development Installation","text":"<p>For contributing or development:</p> <pre><code>git clone https://github.com/ZOO-Project/zoo-runner-common.git\ncd zoo-runner-common\npip install -e .\n</code></pre> <p>This installs the package in editable mode with development dependencies.</p>"},{"location":"getting-started/installation/#verification","title":"Verification","text":"<p>Verify the installation:</p> <pre><code>from base_runner import BaseRunner\nprint(\"zoo-runner-common installed successfully!\")\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Guide</li> <li>Implementing a Runner</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>This guide will help you get started with zoo-runner-common by implementing a simple CWL runner.</p>"},{"location":"getting-started/quickstart/#basic-runner-implementation","title":"Basic Runner Implementation","text":"<pre><code>from base_runner import BaseRunner\n\nclass MyRunner(BaseRunner):\n    \"\"\"Simple CWL runner implementation\"\"\"\n\n    def __init__(self, conf, inputs, outputs):\n        super().__init__(conf, inputs, outputs)\n\n    def execute(self):\n        \"\"\"Execute the CWL workflow\"\"\"\n        # 1. Prepare the workflow\n        cwl_document = self.get_cwl_document()\n\n        # 2. Execute\n        result = self.run_workflow(cwl_document)\n\n        # 3. Return status\n        if result.success:\n            return self.SERVICE_SUCCEEDED\n        else:\n            return self.SERVICE_FAILED\n\n    def run_workflow(self, cwl_doc):\n        \"\"\"Implement your workflow execution logic\"\"\"\n        # Your implementation here\n        pass\n</code></pre>"},{"location":"getting-started/quickstart/#using-zooconf","title":"Using ZooConf","text":"<pre><code>from zoo_conf import ZooConf\n\n# Parse ZOO configuration\nzoo_conf = ZooConf(conf)\n\n# Access inputs\ninput_data = zoo_conf.get_input(\"input_name\")\n\n# Access outputs\noutput_spec = zoo_conf.get_output(\"output_name\")\n</code></pre>"},{"location":"getting-started/quickstart/#using-zoostub-for-testing","title":"Using ZooStub for Testing","text":"<pre><code>from zoostub import ZOO\n\n# Create mock configuration\nconf = {\n    \"lenv\": {\"message\": \"\"},\n    \"main\": {\"tmpPath\": \"/tmp\"}\n}\n\n# Use ZOO status codes\nZOO.SERVICE_SUCCEEDED  # 3\nZOO.SERVICE_FAILED     # 4\n</code></pre>"},{"location":"getting-started/quickstart/#complete-example","title":"Complete Example","text":"<pre><code>from base_runner import BaseRunner\nimport subprocess\n\nclass SimpleRunner(BaseRunner):\n    def execute(self):\n        try:\n            # Get CWL document\n            cwl_path = self.get_cwl_document()\n\n            # Prepare inputs\n            inputs_file = self.prepare_inputs()\n\n            # Run using cwltool\n            cmd = [\"cwltool\", \"--outdir\", self.output_dir, cwl_path, inputs_file]\n            result = subprocess.run(cmd, capture_output=True, text=True)\n\n            if result.returncode == 0:\n                # Process outputs\n                self.process_outputs()\n                return self.SERVICE_SUCCEEDED\n            else:\n                self.set_error(f\"Execution failed: {result.stderr}\")\n                return self.SERVICE_FAILED\n\n        except Exception as e:\n            self.set_error(str(e))\n            return self.SERVICE_FAILED\n</code></pre>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Learn about BaseRunner API</li> <li>Read the Runner Implementation Guide</li> <li>Explore specific runner implementations (Calrissian, Argo, WES)</li> </ul>"},{"location":"user-guide/base-runner/","title":"BaseRunner Guide","text":""},{"location":"user-guide/base-runner/#overview","title":"Overview","text":"<p><code>BaseRunner</code> is the abstract base class for all CWL workflow runners in the ZOO-Project ecosystem.</p>"},{"location":"user-guide/base-runner/#class-structure","title":"Class Structure","text":"<pre><code>from base_runner import BaseRunner\n\nclass MyRunner(BaseRunner):\n    \"\"\"Custom CWL runner implementation\"\"\"\n\n    def __init__(self, cwl, inputs, conf, outputs, execution_handler=None):\n        super().__init__(cwl, inputs, conf, outputs, execution_handler)\n\n    def execute(self):\n        \"\"\"Implement workflow execution logic\"\"\"\n        # Your implementation\n        pass\n</code></pre>"},{"location":"user-guide/base-runner/#constructor-parameters","title":"Constructor Parameters","text":"<pre><code>def __init__(self, cwl, inputs, conf, outputs, execution_handler=None)\n</code></pre> <p>Parameters:</p> <ul> <li><code>cwl</code>: CWL workflow document (path or content)</li> <li><code>inputs</code>: ZOO inputs dictionary</li> <li><code>conf</code>: ZOO configuration dictionary</li> <li><code>outputs</code>: ZOO outputs dictionary</li> <li><code>execution_handler</code>: Optional execution handler (e.g., CommonExecutionHandler)</li> </ul>"},{"location":"user-guide/base-runner/#core-methods","title":"Core Methods","text":""},{"location":"user-guide/base-runner/#prepare","title":"prepare()","text":"<p>Shared pre-execution logic that: - Calls <code>execution_handler.pre_execution_hook()</code> - Prepares processing parameters - Sets up environment</p> <pre><code>def prepare(self):\n    \"\"\"Prepare for execution\"\"\"\n    logger.info(\"execution started\")\n    self.execution_handler.pre_execution_hook()\n    # Additional preparation...\n</code></pre> <p>Usage:</p> <pre><code>runner = MyRunner(cwl, inputs, conf, outputs, handler)\nrunner.prepare()\n</code></pre>"},{"location":"user-guide/base-runner/#execute","title":"execute()","text":"<p>Abstract method that must be implemented by subclasses.</p> <pre><code>@abstractmethod\ndef execute(self):\n    \"\"\"Execute the workflow\"\"\"\n    pass\n</code></pre> <p>Implementation:</p> <pre><code>class MyRunner(BaseRunner):\n    def execute(self):\n        \"\"\"Execute workflow\"\"\"\n        try:\n            self.prepare()\n            result = self.run_workflow()\n            self.log_output(result)\n            return zoo.SERVICE_SUCCEEDED\n        except Exception as e:\n            logger.error(f\"Execution failed: {e}\")\n            return zoo.SERVICE_FAILED\n</code></pre>"},{"location":"user-guide/base-runner/#update_status","title":"update_status()","text":"<p>Update execution status in ZOO.</p> <pre><code>def update_status(self, progress: int, message: str = \"\")\n</code></pre> <p>Parameters:</p> <ul> <li><code>progress</code> (int): Progress percentage (0-100)</li> <li><code>message</code> (str): Status message</li> </ul> <p>Example:</p> <pre><code>runner.update_status(10, \"Downloading inputs...\")\nrunner.update_status(50, \"Processing data...\")\nrunner.update_status(90, \"Uploading results...\")\nrunner.update_status(100, \"Complete\")\n</code></pre>"},{"location":"user-guide/base-runner/#validate_inputs","title":"validate_inputs()","text":"<p>Validate input parameters before execution.</p> <pre><code>def validate_inputs(self) -&gt; bool\n</code></pre> <p>Returns: - bool: True if inputs are valid</p> <p>Override:</p> <pre><code>class MyRunner(BaseRunner):\n    def validate_inputs(self):\n        \"\"\"Custom validation\"\"\"\n        if \"required_param\" not in self.inputs:\n            logger.error(\"Missing required parameter\")\n            return False\n        return True\n</code></pre>"},{"location":"user-guide/base-runner/#log_output","title":"log_output()","text":"<p>Log output information.</p> <pre><code>def log_output(self, output)\n</code></pre> <p>Example:</p> <pre><code>result = {\"status\": \"success\", \"files\": [\"output.tif\"]}\nrunner.log_output(result)\n</code></pre>"},{"location":"user-guide/base-runner/#get_namespace_name","title":"get_namespace_name()","text":"<p>Get or generate namespace name for execution.</p> <pre><code>def get_namespace_name(self) -&gt; str\n</code></pre> <p>Returns: - str: Namespace name (format: <code>{identifier}-{usid}</code>)</p> <p>Example:</p> <pre><code>namespace = runner.get_namespace_name()\n# Returns: \"my-process-12345\"\n</code></pre>"},{"location":"user-guide/base-runner/#execution-handler-integration","title":"Execution Handler Integration","text":"<p>BaseRunner integrates with execution handlers for lifecycle hooks:</p> <pre><code>from base_runner import BaseRunner\nfrom zoo_template_common import CommonExecutionHandler\n\nclass MyHandler(CommonExecutionHandler):\n    def pre_execution_hook(self):\n        \"\"\"Setup before execution\"\"\"\n        print(\"Setting up...\")\n\n    def post_execution_hook(self, log, output, usage_report, tool_logs):\n        \"\"\"Cleanup after execution\"\"\"\n        print(\"Cleaning up...\")\n\n# Use with runner\nhandler = MyHandler(conf, outputs)\nrunner = MyRunner(cwl, inputs, conf, outputs, handler)\n\n# Handler hooks are called automatically\nrunner.prepare()  # Calls handler.pre_execution_hook()\n</code></pre>"},{"location":"user-guide/base-runner/#available-handler-methods","title":"Available Handler Methods","text":"<p>The execution handler provides these methods:</p> <ul> <li><code>pre_execution_hook()</code>: Called before execution</li> <li><code>post_execution_hook(log, output, usage_report, tool_logs)</code>: Called after execution</li> <li><code>get_secrets()</code>: Get secrets from configuration</li> <li><code>get_additional_parameters()</code>: Get workflow parameters</li> <li><code>get_pod_env_vars()</code>: Get pod environment variables</li> <li><code>get_pod_node_selector()</code>: Get node selector for scheduling</li> <li><code>handle_outputs(...)</code>: Process outputs</li> <li><code>set_job_id(job_id)</code>: Set job identifier</li> </ul>"},{"location":"user-guide/base-runner/#default-handler","title":"Default Handler","text":"<p>If no handler is provided, BaseRunner creates a default handler:</p> <pre><code>class DefaultHandler:\n    def pre_execution_hook(self):\n        pass\n\n    def post_execution_hook(self, *args, **kwargs):\n        pass\n\n    def get_secrets(self):\n        return None\n\n    def get_additional_parameters(self):\n        return {}\n\n    def get_pod_env_vars(self):\n        return None\n\n    def get_pod_node_selector(self):\n        return None\n</code></pre>"},{"location":"user-guide/base-runner/#attributes","title":"Attributes","text":""},{"location":"user-guide/base-runner/#cwl","title":"cwl","text":"<p>CWL workflow document.</p> <pre><code>runner.cwl  # Path or content\n</code></pre>"},{"location":"user-guide/base-runner/#inputs","title":"inputs","text":"<p>ZOO inputs dictionary.</p> <pre><code>runner.inputs  # {\"param1\": {\"value\": \"...\"}}\n</code></pre>"},{"location":"user-guide/base-runner/#conf","title":"conf","text":"<p>ZOO configuration dictionary.</p> <pre><code>runner.conf  # {\"lenv\": {...}, \"main\": {...}}\n</code></pre>"},{"location":"user-guide/base-runner/#outputs","title":"outputs","text":"<p>ZOO outputs dictionary.</p> <pre><code>runner.outputs  # {\"result\": {...}}\n</code></pre>"},{"location":"user-guide/base-runner/#execution_handler","title":"execution_handler","text":"<p>Execution handler instance.</p> <pre><code>runner.execution_handler  # Handler instance\n</code></pre>"},{"location":"user-guide/base-runner/#namespace_name","title":"namespace_name","text":"<p>Kubernetes namespace name.</p> <pre><code>runner.namespace_name  # \"process-12345\"\n</code></pre>"},{"location":"user-guide/base-runner/#complete-example","title":"Complete Example","text":"<pre><code>from base_runner import BaseRunner\nfrom zoo_template_common import CommonExecutionHandler\nimport subprocess\nimport logging\n\nlogger = logging.getLogger(__name__)\n\nclass SimpleRunner(BaseRunner):\n    \"\"\"Simple CWL runner using cwltool\"\"\"\n\n    def execute(self):\n        \"\"\"Execute workflow with cwltool\"\"\"\n        try:\n            # Prepare\n            self.prepare()\n            self.update_status(10, \"Preparing execution\")\n\n            # Validate\n            if not self.validate_inputs():\n                return zoo.SERVICE_FAILED\n\n            self.update_status(30, \"Executing workflow\")\n\n            # Execute with cwltool\n            cmd = [\"cwltool\", self.cwl, \"--\"]\n            for key, value in self.inputs.items():\n                cmd.append(f\"{key}={value['value']}\")\n\n            result = subprocess.run(cmd, capture_output=True, text=True)\n\n            if result.returncode == 0:\n                self.update_status(90, \"Processing outputs\")\n                self.outputs[\"result\"] = {\"value\": result.stdout}\n                self.log_output(self.outputs)\n\n                # Call post-execution hook\n                self.execution_handler.post_execution_hook(\n                    result.stdout, self.outputs, None, None\n                )\n\n                self.update_status(100, \"Complete\")\n                return zoo.SERVICE_SUCCEEDED\n            else:\n                logger.error(f\"Execution failed: {result.stderr}\")\n                return zoo.SERVICE_FAILED\n\n        except Exception as e:\n            logger.error(f\"Error: {e}\")\n            return zoo.SERVICE_FAILED\n\n# ZOO Service\ndef my_service(conf, inputs, outputs):\n    \"\"\"ZOO Service using SimpleRunner\"\"\"\n    cwl = conf[\"lenv\"][\"cwl_document\"]\n\n    handler = CommonExecutionHandler(conf, outputs)\n    runner = SimpleRunner(cwl, inputs, conf, outputs, handler)\n\n    return runner.execute()\n</code></pre>"},{"location":"user-guide/base-runner/#best-practices","title":"Best Practices","text":"<ol> <li>Always call prepare(): Ensures handler hooks are executed</li> <li>Use update_status(): Keep users informed of progress</li> <li>Validate inputs: Check parameters before execution</li> <li>Handle errors: Catch and log exceptions</li> <li>Log important events: Use logger for debugging</li> <li>Update outputs: Populate outputs dictionary with results</li> </ol>"},{"location":"user-guide/base-runner/#see-also","title":"See Also","text":"<ul> <li>ZooConf - Configuration parsing</li> <li>Implementing Runners - Create custom runners</li> <li>API Reference - Complete API documentation</li> </ul>"},{"location":"user-guide/zoo-conf/","title":"ZooConf User Guide","text":"<p>The <code>zoo_conf</code> module provides essential utilities for working with ZOO-Project configuration and CWL workflows. This guide covers practical usage patterns.</p>"},{"location":"user-guide/zoo-conf/#overview","title":"Overview","text":"<p>The module contains four main classes:</p> <ul> <li>ZooConf: Configuration handler</li> <li>ZooInputs: Input parameter parser with type conversion</li> <li>ZooOutputs: Output handler</li> <li>CWLWorkflow: CWL workflow parser and analyzer</li> </ul>"},{"location":"user-guide/zoo-conf/#working-with-zooconf","title":"Working with ZooConf","text":"<p><code>ZooConf</code> is a simple wrapper around the ZOO-Project configuration dictionary.</p>"},{"location":"user-guide/zoo-conf/#basic-usage","title":"Basic Usage","text":"<pre><code>from zoo_conf import ZooConf\n\ndef my_service(conf, inputs, outputs):\n    zoo_conf = ZooConf(conf)\n\n    # Get the workflow identifier\n    workflow_id = zoo_conf.workflow_id  # From conf[\"lenv\"][\"Identifier\"]\n\n    # Access underlying conf dict\n    tmp_path = zoo_conf.conf[\"main\"][\"tmpPath\"]\n\n    return 3\n</code></pre>"},{"location":"user-guide/zoo-conf/#handling-inputs-with-zooinputs","title":"Handling Inputs with ZooInputs","text":"<p><code>ZooInputs</code> handles the complexity of ZOO input parsing, including type conversion and array handling.</p>"},{"location":"user-guide/zoo-conf/#type-conversion","title":"Type Conversion","text":"<p>ZOO-Project passes all values as strings. <code>ZooInputs</code> automatically converts them to appropriate Python types:</p> <pre><code>from zoo_conf import ZooInputs\n\ninputs = {\n    \"threshold\": {\n        \"dataType\": \"float\",\n        \"value\": \"0.85\"\n    },\n    \"max_iterations\": {\n        \"dataType\": \"integer\",\n        \"value\": \"100\"\n    },\n    \"enable_cache\": {\n        \"dataType\": \"boolean\",\n        \"value\": \"1\"\n    }\n}\n\nzoo_inputs = ZooInputs(inputs)\nparams = zoo_inputs.get_processing_parameters()\n\n# Result:\n# {\n#     'threshold': 0.85,         # float\n#     'max_iterations': 100,     # int\n#     'enable_cache': 1          # int (boolean)\n# }\n</code></pre>"},{"location":"user-guide/zoo-conf/#file-inputs","title":"File Inputs","text":"<p>File inputs are converted to CWL File objects:</p> <pre><code>inputs = {\n    \"input_raster\": {\n        \"cache_file\": \"/tmp/zTMPykgmh8/data.tif\",\n        \"mimeType\": \"image/tiff\"\n    },\n    \"config_file\": {\n        \"cache_file\": \"/tmp/zTMPykgmh8/config.json\",\n        \"mimeType\": \"application/json\"\n    }\n}\n\nzoo_inputs = ZooInputs(inputs)\nparams = zoo_inputs.get_processing_parameters()\n\n# Result:\n# {\n#     'input_raster': {\n#         'class': 'File',\n#         'path': '/tmp/zTMPykgmh8/data.tif',\n#         'format': 'image/tiff'\n#     },\n#     'config_file': {\n#         'class': 'File',\n#         'path': '/tmp/zTMPykgmh8/config.json',\n#         'format': 'application/json'\n#     }\n# }\n</code></pre>"},{"location":"user-guide/zoo-conf/#array-inputs","title":"Array Inputs","text":"<p>ZOO-Project has a quirk: arrays with one element are converted to strings. <code>ZooInputs</code> automatically handles this:</p> <pre><code>inputs = {\n    \"bands\": {\n        \"maxOccurs\": \"3\",\n        \"value\": \"B02\"  # Single value, but should be array\n    }\n}\n\nzoo_inputs = ZooInputs(inputs)\n\n# Automatically converted to array:\n# inputs[\"bands\"][\"value\"] = [\"B02\"]\n</code></pre>"},{"location":"user-guide/zoo-conf/#getting-individual-input-values","title":"Getting Individual Input Values","text":"<pre><code>zoo_inputs = ZooInputs(inputs)\n\n# Get specific input\ntry:\n    threshold = zoo_inputs.get_input_value(\"threshold\")\nexcept KeyError:\n    print(\"threshold parameter not provided\")\n</code></pre>"},{"location":"user-guide/zoo-conf/#handling-outputs-with-zoooutputs","title":"Handling Outputs with ZooOutputs","text":"<p><code>ZooOutputs</code> simplifies setting service output values.</p>"},{"location":"user-guide/zoo-conf/#basic-output","title":"Basic Output","text":"<pre><code>from zoo_conf import ZooOutputs\n\ndef my_service(conf, inputs, outputs):\n    # ... processing ...\n\n    zoo_outputs = ZooOutputs(outputs)\n\n    # Set the result\n    zoo_outputs.set_output(\"/tmp/results/catalog.json\")\n\n    return 3\n</code></pre>"},{"location":"user-guide/zoo-conf/#multiple-outputs","title":"Multiple Outputs","text":"<pre><code>outputs = {\n    \"result\": {},\n    \"metadata\": {}\n}\n\nzoo_outputs = ZooOutputs(outputs)\n\n# Sets the primary output (first key)\nzoo_outputs.set_output(\"/tmp/result.tif\")\n\n# For additional outputs, set directly\noutputs[\"metadata\"][\"value\"] = \"/tmp/metadata.json\"\n</code></pre>"},{"location":"user-guide/zoo-conf/#getting-output-parameters","title":"Getting Output Parameters","text":"<pre><code>zoo_outputs = ZooOutputs(outputs)\noutput_params = zoo_outputs.get_output_parameters()\n# {'result': '/tmp/result.tif', 'metadata': '/tmp/metadata.json'}\n</code></pre>"},{"location":"user-guide/zoo-conf/#working-with-cwl-workflows","title":"Working with CWL Workflows","text":"<p><code>CWLWorkflow</code> provides utilities for parsing and analyzing CWL workflows.</p>"},{"location":"user-guide/zoo-conf/#loading-a-workflow","title":"Loading a Workflow","text":"<pre><code>from zoo_conf import CWLWorkflow\n\n# Load from dict\ncwl_dict = {\n    \"cwlVersion\": \"v1.0\",\n    \"$graph\": [\n        {\n            \"class\": \"Workflow\",\n            \"id\": \"main-workflow\",\n            \"label\": \"My Workflow\",\n            \"doc\": \"Process satellite imagery\",\n            \"inputs\": [...],\n            \"outputs\": [...],\n            \"steps\": [...]\n        }\n    ],\n    \"s:softwareVersion\": \"1.2.0\"\n}\n\nworkflow = CWLWorkflow(cwl_dict, \"main-workflow\")\n</code></pre>"},{"location":"user-guide/zoo-conf/#getting-workflow-metadata","title":"Getting Workflow Metadata","text":"<pre><code># Version\nversion = workflow.get_version()  # \"1.2.0\"\n\n# Label\nlabel = workflow.get_label()  # \"My Workflow\"\n\n# Documentation\ndoc = workflow.get_doc()  # \"Process satellite imagery\"\n</code></pre>"},{"location":"user-guide/zoo-conf/#analyzing-workflow-inputs","title":"Analyzing Workflow Inputs","text":"<pre><code># Get all inputs\nall_inputs = workflow.get_workflow_inputs()\n# ['input_data', 'threshold', 'bands', 'output_format']\n\n# Get only mandatory inputs (no default values)\nrequired_inputs = workflow.get_workflow_inputs(mandatory=True)\n# ['input_data']\n\n# Validate that required inputs are provided\nzoo_inputs = ZooInputs(inputs)\nfor required in required_inputs:\n    try:\n        zoo_inputs.get_input_value(required)\n    except KeyError:\n        raise ValueError(f\"Missing required input: {required}\")\n</code></pre>"},{"location":"user-guide/zoo-conf/#resource-requirements","title":"Resource Requirements","text":"<p>Analyze and aggregate resource requirements across the workflow:</p> <pre><code>resources = workflow.eval_resource()\n\n# Result:\n# {\n#     'coresMin': [2, 4, 1],      # Requirements from each step\n#     'coresMax': [4, 8, 2],\n#     'ramMin': [2048, 4096, 512],\n#     'ramMax': [4096, 8192, 1024],\n#     'tmpdirMin': [1024],\n#     'tmpdirMax': [2048],\n#     'outdirMin': [512],\n#     'outdirMax': [1024]\n# }\n\n# Calculate totals\ntotal_cores_min = sum(resources['coresMin'])  # 7\ntotal_ram_min = sum(resources['ramMin'])      # 6656 MB\n\n# Use maximum values for resource allocation\nmax_cores = max(resources['coresMax'])  # 8\nmax_ram = max(resources['ramMax'])      # 8192 MB\n\nprint(f\"Request {max_cores} cores and {max_ram} MB RAM\")\n</code></pre>"},{"location":"user-guide/zoo-conf/#scatter-operations","title":"Scatter Operations","text":"<p>The resource evaluator automatically accounts for scatter operations:</p> <pre><code>import os\n\n# Set scatter multiplier (default: 2)\nos.environ[\"SCATTER_MULTIPLIER\"] = \"3\"\n\nworkflow = CWLWorkflow(cwl_dict, \"main-workflow\")\nresources = workflow.eval_resource()\n\n# Steps with scatter will have their resources multiplied by 3\n</code></pre>"},{"location":"user-guide/zoo-conf/#complete-service-example","title":"Complete Service Example","text":"<p>Here's a complete ZOO service using all the utilities:</p> <pre><code>from zoo_conf import ZooConf, ZooInputs, ZooOutputs, CWLWorkflow\nfrom base_runner import BaseRunner\n\ndef process_imagery(conf, inputs, outputs):\n    \"\"\"\n    ZOO Service for processing satellite imagery\n    \"\"\"\n    try:\n        # Parse configuration\n        zoo_conf = ZooConf(conf)\n        workflow_id = zoo_conf.workflow_id\n\n        # Load CWL workflow\n        cwl_path = f\"/opt/zooservices/{workflow_id}/app-package.cwl\"\n        with open(cwl_path) as f:\n            import yaml\n            cwl_dict = yaml.safe_load(f)\n\n        workflow = CWLWorkflow(cwl_dict, workflow_id)\n\n        # Validate inputs\n        required_inputs = workflow.get_workflow_inputs(mandatory=True)\n        zoo_inputs = ZooInputs(inputs)\n\n        for required in required_inputs:\n            try:\n                zoo_inputs.get_input_value(required)\n            except KeyError:\n                conf[\"lenv\"][\"message\"] = f\"Missing required input: {required}\"\n                return 4  # SERVICE_FAILED\n\n        # Get processing parameters\n        params = zoo_inputs.get_processing_parameters()\n\n        # Evaluate resources\n        resources = workflow.eval_resource()\n        total_ram = sum(resources['ramMin'])\n        conf[\"lenv\"][\"message\"] = f\"Workflow requires {total_ram} MB RAM\"\n\n        # Create runner\n        runner = BaseRunner(\n            cwl_path=cwl_path,\n            input_params=params,\n            conf=conf\n        )\n\n        # Execute\n        result = runner.execute()\n\n        # Set outputs\n        zoo_outputs = ZooOutputs(outputs)\n        zoo_outputs.set_output(result[\"stac_catalog\"])\n\n        return 3  # SERVICE_SUCCEEDED\n\n    except Exception as e:\n        conf[\"lenv\"][\"message\"] = str(e)\n        return 4  # SERVICE_FAILED\n</code></pre>"},{"location":"user-guide/zoo-conf/#best-practices","title":"Best Practices","text":""},{"location":"user-guide/zoo-conf/#1-always-use-zooinputs-for-type-conversion","title":"1. Always Use ZooInputs for Type Conversion","text":"<pre><code># \u2705 DO: Use ZooInputs for automatic type conversion\nzoo_inputs = ZooInputs(inputs)\nparams = zoo_inputs.get_processing_parameters()\n\n# \u274c DON'T: Manual parsing (error-prone)\nthreshold = float(inputs[\"threshold\"][\"value\"])\n</code></pre>"},{"location":"user-guide/zoo-conf/#2-validate-mandatory-inputs","title":"2. Validate Mandatory Inputs","text":"<pre><code># \u2705 DO: Check for required inputs\nworkflow = CWLWorkflow(cwl_dict, workflow_id)\nrequired = workflow.get_workflow_inputs(mandatory=True)\n\nzoo_inputs = ZooInputs(inputs)\nfor inp in required:\n    try:\n        zoo_inputs.get_input_value(inp)\n    except KeyError:\n        return 4  # SERVICE_FAILED\n</code></pre>"},{"location":"user-guide/zoo-conf/#3-use-resource-evaluation","title":"3. Use Resource Evaluation","text":"<pre><code># \u2705 DO: Evaluate and communicate resource requirements\nresources = workflow.eval_resource()\ntotal_ram = sum(resources['ramMin'])\nconf[\"lenv\"][\"message\"] = f\"Requires {total_ram} MB RAM\"\n</code></pre>"},{"location":"user-guide/zoo-conf/#4-handle-arrays-correctly","title":"4. Handle Arrays Correctly","text":"<pre><code># \u2705 DO: Let ZooInputs handle array conversion\nzoo_inputs = ZooInputs(inputs)  # Handles single-value arrays automatically\n\n# \u274c DON'T: Assume inputs[\"array\"][\"value\"] is always a list\n</code></pre>"},{"location":"user-guide/zoo-conf/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/zoo-conf/#array-input-not-recognized","title":"Array Input Not Recognized","text":"<p>Problem: Single-value array becomes a string</p> <p>Solution: Use <code>ZooInputs</code> - it automatically handles this:</p> <pre><code>zoo_inputs = ZooInputs(inputs)\n# Arrays with maxOccurs &gt; 1 are automatically converted\n</code></pre>"},{"location":"user-guide/zoo-conf/#type-conversion-errors","title":"Type Conversion Errors","text":"<p>Problem: String values not converting to numbers</p> <p>Solution: Ensure <code>dataType</code> is set in input definition:</p> <pre><code>inputs = {\n    \"threshold\": {\n        \"dataType\": \"float\",  # Required for conversion\n        \"value\": \"0.85\"\n    }\n}\n</code></pre>"},{"location":"user-guide/zoo-conf/#resource-evaluation-returns-empty-lists","title":"Resource Evaluation Returns Empty Lists","text":"<p>Problem: <code>eval_resource()</code> returns empty lists</p> <p>Solution: Ensure CWL workflow has ResourceRequirement in requirements or hints:</p> <pre><code>requirements:\n  ResourceRequirement:\n    coresMin: 2\n    ramMin: 2048\n</code></pre>"},{"location":"user-guide/zoo-conf/#see-also","title":"See Also","text":"<ul> <li>API Reference: ZooConf</li> <li>BaseRunner User Guide</li> <li>Implementing Custom Runners</li> </ul>"},{"location":"user-guide/zoo-stub/","title":"ZooStub User Guide","text":"<p>The <code>ZooStub</code> class provides a mock implementation of ZOO-Project's runtime functions for local testing and development.</p>"},{"location":"user-guide/zoo-stub/#overview","title":"Overview","text":"<p>When developing ZOO services locally, you don't have access to the actual ZOO-Project runtime functions like status updates and logging. <code>ZooStub</code> provides compatible implementations that allow you to test your services outside of the ZOO environment.</p>"},{"location":"user-guide/zoo-stub/#features","title":"Features","text":"<ul> <li>Status Constants: Service execution status codes</li> <li>Status Updates: Mock <code>update_status()</code> for testing</li> <li>Logging: Integration with <code>loguru</code> for local logging</li> <li>Translation: Mock <code>_()</code> for internationalization</li> </ul>"},{"location":"user-guide/zoo-stub/#status-constants","title":"Status Constants","text":"<pre><code>from zoostub import ZooStub\n\nzoo = ZooStub()\n\n# Available status codes\nzoo.SERVICE_ACCEPTED     # 0 - Service request accepted\nzoo.SERVICE_STARTED      # 1 - Service execution started\nzoo.SERVICE_PAUSED       # 2 - Service paused (deprecated)\nzoo.SERVICE_SUCCEEDED    # 3 - Service completed successfully\nzoo.SERVICE_FAILED       # 4 - Service failed\nzoo.SERVICE_DEPLOYED     # 6 - Service deployed\nzoo.SERVICE_UNDEPLOYED   # 7 - Service undeployed\n</code></pre>"},{"location":"user-guide/zoo-stub/#basic-usage","title":"Basic Usage","text":""},{"location":"user-guide/zoo-stub/#local-testing-setup","title":"Local Testing Setup","text":"<pre><code>from zoostub import ZooStub\n\n# Create stub instance\nzoo = ZooStub()\n\ndef my_service(conf, inputs, outputs):\n    \"\"\"ZOO Service for local testing\"\"\"\n\n    # Update status\n    zoo.update_status(conf, 20)\n\n    # Log progress\n    zoo.info(\"Processing started\")\n\n    # ... processing ...\n\n    zoo.info(\"Processing completed\")\n    zoo.update_status(conf, 100)\n\n    return zoo.SERVICE_SUCCEEDED\n</code></pre>"},{"location":"user-guide/zoo-stub/#status-updates","title":"Status Updates","text":"<pre><code>from zoostub import ZooStub\n\nzoo = ZooStub()\n\n# Simulate progress updates\nzoo.update_status(conf, 10)   # 10% complete\nzoo.update_status(conf, 50)   # 50% complete\nzoo.update_status(conf, 100)  # 100% complete\n\n# Output:\n# Status 10\n# Status 50\n# Status 100\n</code></pre> <p>In production, this calls the actual ZOO-Project C function to update the execution status.</p>"},{"location":"user-guide/zoo-stub/#logging-functions","title":"Logging Functions","text":"<p><code>ZooStub</code> integrates with <code>loguru</code> for comprehensive logging:</p>"},{"location":"user-guide/zoo-stub/#available-log-levels","title":"Available Log Levels","text":"<pre><code>from zoostub import ZooStub\n\nzoo = ZooStub()\n\n# Trace level (most verbose)\nzoo.trace(\"Detailed execution trace\")\n\n# Debug level\nzoo.debug(\"Debug information\")\n\n# Info level\nzoo.info(\"General information\")\n\n# Success level\nzoo.success(\"Operation completed successfully\")\n\n# Warning level\nzoo.warning(\"Potential issue detected\")\n\n# Error level\nzoo.error(\"An error occurred\")\n\n# Critical level (most severe)\nzoo.critical(\"Critical system error\")\n</code></pre>"},{"location":"user-guide/zoo-stub/#example-with-real-service","title":"Example with Real Service","text":"<pre><code>from zoostub import ZooStub\nfrom base_runner import BaseRunner\n\nzoo = ZooStub()\n\ndef process_data(conf, inputs, outputs):\n    \"\"\"Process data with comprehensive logging\"\"\"\n\n    zoo.info(\"Service started\")\n    zoo.update_status(conf, 10)\n\n    try:\n        # Validate inputs\n        zoo.debug(f\"Inputs: {inputs}\")\n\n        if \"data_url\" not in inputs:\n            zoo.error(\"Missing required input: data_url\")\n            return zoo.SERVICE_FAILED\n\n        zoo.info(\"Creating runner\")\n        zoo.update_status(conf, 20)\n\n        runner = BaseRunner(\n            cwl_path=\"/path/to/workflow.cwl\",\n            input_params=inputs,\n            conf=conf\n        )\n\n        zoo.info(\"Executing workflow\")\n        zoo.update_status(conf, 50)\n\n        result = runner.execute()\n\n        zoo.success(\"Workflow completed successfully\")\n        zoo.update_status(conf, 90)\n\n        # Set outputs\n        outputs[\"result\"][\"value\"] = result[\"stac_catalog\"]\n\n        zoo.info(\"Service completed\")\n        zoo.update_status(conf, 100)\n\n        return zoo.SERVICE_SUCCEEDED\n\n    except FileNotFoundError as e:\n        zoo.error(f\"File not found: {e}\")\n        return zoo.SERVICE_FAILED\n\n    except Exception as e:\n        zoo.critical(f\"Unexpected error: {e}\")\n        return zoo.SERVICE_FAILED\n</code></pre>"},{"location":"user-guide/zoo-stub/#translation-function","title":"Translation Function","text":"<p>The <code>_()</code> function provides a mock for internationalization:</p> <pre><code>from zoostub import ZooStub\n\nzoo = ZooStub()\n\n# Mock translation (just prints in stub)\nmessage = zoo._(\"Processing started\")\n# Output: invoked _ with Processing started\n\n# In production, this would use ZOO's translation system\n</code></pre>"},{"location":"user-guide/zoo-stub/#using-in-development-vs-production","title":"Using in Development vs Production","text":""},{"location":"user-guide/zoo-stub/#development-with-zoostub","title":"Development (with ZooStub)","text":"<pre><code>from zoostub import ZooStub\n\nzoo = ZooStub()\n\ndef my_service(conf, inputs, outputs):\n    zoo.info(\"Running locally\")\n    zoo.update_status(conf, 50)\n    # ... processing ...\n    return zoo.SERVICE_SUCCEEDED\n\n# Test locally\nif __name__ == \"__main__\":\n    conf = {\"lenv\": {\"message\": \"\"}}\n    inputs = {\"data\": {\"value\": \"test.tif\"}}\n    outputs = {}\n\n    status = my_service(conf, inputs, outputs)\n    print(f\"Service returned: {status}\")\n</code></pre>"},{"location":"user-guide/zoo-stub/#production-with-real-zoo","title":"Production (with real ZOO)","text":"<pre><code>try:\n    import zoo\nexcept ImportError:\n    from zoostub import ZooStub\n    zoo = ZooStub()\n\ndef my_service(conf, inputs, outputs):\n    \"\"\"Works in both development and production\"\"\"\n    zoo.info(\"Service started\")\n    zoo.update_status(conf, 50)\n    # ... processing ...\n    return zoo.SERVICE_SUCCEEDED\n</code></pre>"},{"location":"user-guide/zoo-stub/#integration-with-baserunner","title":"Integration with BaseRunner","text":"<p><code>ZooStub</code> works seamlessly with <code>BaseRunner</code>:</p> <pre><code>from zoostub import ZooStub\nfrom base_runner import BaseRunner\n\nzoo = ZooStub()\n\ndef test_runner_locally():\n    \"\"\"Test a CWL workflow locally\"\"\"\n\n    conf = {\n        \"lenv\": {\n            \"Identifier\": \"test-workflow\",\n            \"message\": \"\"\n        },\n        \"main\": {\n            \"tmpPath\": \"/tmp/zoo-test\"\n        }\n    }\n\n    inputs = {\n        \"input_file\": {\n            \"cache_file\": \"/path/to/test.tif\",\n            \"mimeType\": \"image/tiff\"\n        },\n        \"threshold\": {\n            \"dataType\": \"float\",\n            \"value\": \"0.5\"\n        }\n    }\n\n    outputs = {\"stac\": {}}\n\n    zoo.info(\"Starting local test\")\n\n    runner = BaseRunner(\n        cwl_path=\"/path/to/app-package.cwl\",\n        input_params=inputs,\n        conf=conf\n    )\n\n    zoo.info(\"Executing workflow\")\n    result = runner.execute()\n\n    zoo.success(f\"Result: {result}\")\n\n    return zoo.SERVICE_SUCCEEDED\n\nif __name__ == \"__main__\":\n    status = test_runner_locally()\n    print(f\"Test completed with status: {status}\")\n</code></pre>"},{"location":"user-guide/zoo-stub/#logging-configuration","title":"Logging Configuration","text":"<p>Customize <code>loguru</code> logging when using <code>ZooStub</code>:</p> <pre><code>from loguru import logger\nfrom zoostub import ZooStub\n\n# Configure loguru\nlogger.remove()  # Remove default handler\nlogger.add(\n    \"service.log\",\n    rotation=\"10 MB\",\n    level=\"DEBUG\",\n    format=\"{time:YYYY-MM-DD HH:mm:ss} | {level: &lt;8} | {message}\"\n)\n\nzoo = ZooStub()\n\n# Now all zoo.info(), zoo.debug(), etc. use custom config\nzoo.info(\"Service started\")\nzoo.debug(\"Debug message\")\n</code></pre>"},{"location":"user-guide/zoo-stub/#best-practices","title":"Best Practices","text":""},{"location":"user-guide/zoo-stub/#1-import-pattern-for-developmentproduction","title":"1. Import Pattern for Development/Production","text":"<pre><code># \u2705 DO: Support both environments\ntry:\n    import zoo\nexcept ImportError:\n    from zoostub import ZooStub\n    zoo = ZooStub()\n</code></pre>"},{"location":"user-guide/zoo-stub/#2-consistent-status-updates","title":"2. Consistent Status Updates","text":"<pre><code># \u2705 DO: Regular status updates\nzoo.update_status(conf, 0)    # Started\nzoo.update_status(conf, 25)   # 1/4 complete\nzoo.update_status(conf, 50)   # 1/2 complete\nzoo.update_status(conf, 75)   # 3/4 complete\nzoo.update_status(conf, 100)  # Complete\n</code></pre>"},{"location":"user-guide/zoo-stub/#3-appropriate-log-levels","title":"3. Appropriate Log Levels","text":"<pre><code># \u2705 DO: Use appropriate log levels\nzoo.debug(\"Variable value: {value}\")     # Development info\nzoo.info(\"Processing step completed\")    # Normal operation\nzoo.warning(\"Using default value\")       # Potential issue\nzoo.error(\"Failed to connect to API\")    # Error occurred\nzoo.critical(\"System out of memory\")     # Critical failure\n\n# \u274c DON'T: Use info for everything\n</code></pre>"},{"location":"user-guide/zoo-stub/#4-error-handling-with-logging","title":"4. Error Handling with Logging","text":"<pre><code># \u2705 DO: Log errors with context\ntry:\n    result = process_data()\nexcept ValueError as e:\n    zoo.error(f\"Invalid data format: {e}\")\n    return zoo.SERVICE_FAILED\nexcept Exception as e:\n    zoo.critical(f\"Unexpected error: {e}\")\n    return zoo.SERVICE_FAILED\n</code></pre>"},{"location":"user-guide/zoo-stub/#testing-example","title":"Testing Example","text":"<p>Create a complete test with <code>ZooStub</code>:</p> <pre><code>from zoostub import ZooStub\nfrom zoo_conf import ZooInputs, ZooOutputs\n\nzoo = ZooStub()\n\ndef test_service_locally():\n    \"\"\"Complete local service test\"\"\"\n\n    # Setup test data\n    conf = {\n        \"lenv\": {\"Identifier\": \"test\", \"message\": \"\"},\n        \"main\": {\"tmpPath\": \"/tmp/test\"}\n    }\n\n    inputs = {\n        \"threshold\": {\n            \"dataType\": \"float\",\n            \"value\": \"0.75\"\n        },\n        \"input_file\": {\n            \"cache_file\": \"/tmp/test.tif\",\n            \"mimeType\": \"image/tiff\"\n        }\n    }\n\n    outputs = {\"result\": {}}\n\n    # Run service\n    zoo.info(\"=== Starting Service Test ===\")\n    zoo.update_status(conf, 0)\n\n    # Parse inputs\n    zoo_inputs = ZooInputs(inputs)\n    params = zoo_inputs.get_processing_parameters()\n    zoo.debug(f\"Parameters: {params}\")\n\n    # Simulate processing\n    zoo.info(\"Processing data...\")\n    zoo.update_status(conf, 50)\n\n    # Set results\n    zoo_outputs = ZooOutputs(outputs)\n    zoo_outputs.set_output(\"/tmp/result.json\")\n\n    zoo.success(\"Service completed successfully\")\n    zoo.update_status(conf, 100)\n\n    return zoo.SERVICE_SUCCEEDED\n\nif __name__ == \"__main__\":\n    status = test_service_locally()\n\n    if status == 3:\n        print(\"\u2713 Test PASSED\")\n    else:\n        print(\"\u2717 Test FAILED\")\n</code></pre>"},{"location":"user-guide/zoo-stub/#limitations","title":"Limitations","text":"<p><code>ZooStub</code> is for local testing only. It provides:</p> <ul> <li>\u2705 Status code constants</li> <li>\u2705 Mock status updates (prints to console)</li> <li>\u2705 Logging via loguru</li> <li>\u2705 Mock translation function</li> </ul> <p>It does NOT provide:</p> <ul> <li>\u274c Actual ZOO-Project runtime integration</li> <li>\u274c Real status updates to ZOO server</li> <li>\u274c ZOO-Project's full API</li> <li>\u274c Multi-language translation</li> </ul>"},{"location":"user-guide/zoo-stub/#see-also","title":"See Also","text":"<ul> <li>BaseRunner User Guide</li> <li>ZooConf User Guide</li> <li>Implementing Custom Runners</li> </ul>"}]}